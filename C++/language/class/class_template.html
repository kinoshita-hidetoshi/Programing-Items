<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="kinoshita hidetoshi (木下 英俊)">
  <meta name="description" content="木下英俊が自身のためにプログラムメモを残すことを目的に作成したページです">
  <meta name="keywords" content="">
  <!-- キャッシュ無効化 -->
  <meta http-equiv="Cache-Control" content="no-cache">
	
  <!-- タイトル -->
  <title>クラスの基本テンプレート | Programming Items</title>
	
  <!-- ファビコン -->
  <link rel="shortcut icon" href="../../../favicon.ico">
  
  <!-- CSS -->
  <link href="https://unpkg.com/ress/dist/ress.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../../../design.css" type="text/css">
  
	<!-- Start for 'google-code-prettify' -->
	<link href="../../../prettify/styles/desert.css" rel="stylesheet" type="text/css">
	<script src="../../../prettify/prettify.js" type="text/javascript"></script>
	<!-- End for 'google-code-prettify' -->	
	
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V2DZQK54C2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-V2DZQK54C2');
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->

  <style type="text/css">
  .auto-style1 {
    background-color: #505000;
  }
  </style>

</head>

<body onload="prettyPrint();">

  <h1>クラスの基本テンプレート</h1>
  
  <p> c++ の class は、最低限必要とするコンストラクタやメンバー関数がいろいろあります。<br>加えて &quot;自動的に作成される特殊メンバ関数&quot; 
  なんてものがあり、さらに面倒なことに自動的に生成されるルールがあるため、自動生成されたり、自動生成されなかったりします。正直、お手本のソースコードでも用意しておかないと難しい内容です。</p>
  <p> 本ページでは、c++ の class 
  の雛形を用意して、これをもとにして必要な修正を行うだけである程度のコーディングを行えるようにすることを目指します。</p>
  <p> &nbsp;</p>
    
  <div class="mokuji">
    <nav>
    	<h2>目次</h2>
    	<p><a href="#1._暗黙定義される関数の_default_指定(c++11)">1. 暗黙定義される関数の default 
        (c++11)</a></p>
        <p><a href="#2._暗黙定義される関数の_delete_指定(c++11)">2. 暗黙定義される関数の delete (c++11)</a></p>
        <p><a href="#3._基本の_class_表記_(=_default_利用)">3. 基本の class 表記 ("= default" 利用)</a></p>
        <p><a href="#4._基本の_class_表記_(=_default_無し)">4. 基本の class 表記 ("= default" 無し)</a></p>
    	<p>&nbsp;</p>
    	<p><a href="#ライセンス">ライセンス</a></p>
    	<p><a href="#参考">参考</a></p>
    </nav>
  </div>
  
  <p> &nbsp;</p>
  <p> &nbsp;</p>
  
  <section>
    <h2><a name="1._暗黙定義される関数の_default_指定(c++11)">1. 暗黙定義される関数の default 指定(c++11)</a></h2>
    <p>クラスには、暗黙的に作成されるメンバ関数があります。以下がそれに該当します。</p>
    <p>&nbsp;</p>
    <ul>
      <li>デフォルトコンストラクタ</li>
      <li>デストラクタ</li>
      <li>コピーコンストラクタ</li>
      <li>コピー代入演算子</li>
      <li>ムーブコンストラクタ</li>
      <li>ムーブ代入演算子</li>
    </ul>
    <p>&nbsp;</p>
    <p><span class="cpp-source">= default</span> は、これらに対して以下のように明示的にデフォルトのものを使う指定ができます。</p>
    <p>&nbsp;</p>
    
    <pre class="prettyprint linenums lang-cpp" style="width:800px">
class S {
    S() = default;
}</pre>
 
    <p>&nbsp;</p>
    <p>クラスにコンストラクタが1つも宣言されていない場合、デフォルトコンストラクタ、コピーコンストラクタ、およびムーブコンストラクタが暗黙的に生成されます。しかし、コンストラクタが１つでも宣言されると、それらは暗黙的に生成されなくなります。 
    <span class="cpp-source">= default</span> 
    を用いることで、これらのメンバ関数を暗黙的に生成されたものと同じように生成できます。</p>
    <p>&nbsp;</p>
 
  </section>
  
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="2._暗黙定義される関数の_delete_指定(c++11)">2. 暗黙定義される関数の delete 指定(c++11)</a></h2>
    <p><span class="cpp-source">= delete</span> 
    は、コンパイラが暗黙的に生成する特殊なメンバ関数の削除を指定します。例えば、コピーはできないがムーブは可能なクラス、は以下のように定義します。</p>
    <p>&nbsp;</p>
    
    <pre class="prettyprint linenums lang-cpp" style="width:800px">
class S {
    // コピーできない
    S(const S&amp;) = delete;
    S&amp; operator=(const S&amp;) = delete;

    // ムーブは可能
    S(S&amp;&amp; s) {
        ･･･
    }
};</pre>

    <p>&nbsp;</p>
    <p><span class="cpp-source">= delete</span> 
    は、特殊メンバ関数に対してだけでなく、通常の関数に対しても指定できます。その場合、delete 
    指定された関数オーバーロードが呼び出されると、コンパイルエラーになります。</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
  </section>

  <p>&nbsp;</p>
  
  <section>
  
    <h2><a name="3._基本の_class_表記_(=_default_利用)">3. 基本の class 表記 ("= default" 利用)</a></h2>
    
    <h4> [概要]</h4>
    <p> 一番シンプルであろうテンプレートを以下に示します。<br>c++11 以降を前提に、まずは default 
    指定で全て記載した例を示します。<br>&quot;自動的に作成される特殊メンバ関数&quot; を全て default 
    指定しているので、自動的に作成されるメンバ関数はありません。</p>
    <p>&nbsp;</p>
  
    <h4>[評価環境]</h4>
  	<table>
    	<tbody>
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>コンパイラ :</td>
  	      <td>g++,</td>
  	      <td>13.3.0 </td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>OS :</td>
    	    <td>Ubuntu,</td>
    	    <td>24.04 </td>
    	  </tr>
    	  
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    	</tbody>
  	</table>
    	
    <p>&nbsp;</p>
    
    <p>[プログラムソース &quot;class_template_01.cpp&quot;]</p>
    <pre class="prettyprint linenums lang-cpp" style="width:800px">
#include &lt;utility&gt;  // std::move

class Base {
public:
    Base() = default;                               // default constructor
    virtual ~Base() = default;                      // virtual destructor

    Base(const Base&amp;) = default;                    // copy constructor
    Base&amp; operator = (const Base&amp;) = default;       // copy operator

    Base(Base&amp;&amp;) = default;                         // move constructor
    Base&amp; operator = (Base&amp;&amp;) = default;            // move operator
};

int main()
{
    Base b1;                // call 'default constructor'.
    Base b2(b1);            // call 'copy constructor'.
    Base b3 = b2;           // call 'copy operator'.
    Base b4(Base{});        // call 'move constructor'.
    Base b5 = Base();       // call 'move operator'.
        
    Base b6;
    b6 = b1;                // call 'copy operator'.
    Base b7;
    b7 = std::move(b1);     // call 'move operator'.
    
    return 0;
}</pre>

    <p>&nbsp;</p>
    <p>下記コマンドでビルドします。</p>
    
    <pre class="prettyprint" style="width:800px">
$ g++ -std=c++23 -Wall -Wextra -Wpedantic class_template_01.cpp -o class_template_01.out</pre>

    <p>&nbsp;</p>
    <p>実行結果は以下の通り・・・何も起こりません。残念ながらそういうプログラムです。</p>
  
    <pre class="prettyprint" style="width:800px">
$ ./class_template_01.out
$</pre>

    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>ちょっとだけプログラムを追加して、コピーやムーブしていることを確認してみたいと思います。</p>
    <p>&nbsp;</p>
    <p>[プログラムソース &quot;class_template_02.cpp&quot;]</p>
    <pre class="prettyprint linenums lang-cpp" style="width:800px">
#include &lt;utility&gt;  // std::move
#include &lt;string&gt;
#include &lt;iostream&gt;

class Base {
<span class="auto-style1">public:</span>
<span class="auto-style1">    std::string name = "default_name";</span>

public:
    Base() = default;                               // default constructor
    virtual ~Base() = default;                      // virtual destructor

    Base(const Base&amp;) = default;                    // copy constructor
    Base&amp; operator = (const Base&amp;) = default;       // copy operator

    Base(Base&amp;&amp;) = default;                         // move constructor
    Base&amp; operator = (Base&amp;&amp;) = default;            // move operator
};

int main()
{
    Base b1;                // call 'default constructor'.
<span class="auto-style1">    b1.name = "b1";</span>
    Base b2(b1);            // call 'copy constructor'.
    Base b3 = b2;           // call 'copy operator'.
    Base b4(Base{});        // call 'move constructor'.
    Base b5 = Base();       // call 'move operator'.
    
    Base b6;
    b6 = b1;                // call 'copy operator'.
    Base b7;
    b7 = std::move(b1);     // call 'move operator'.

<span class="auto-style1">    // 確認 </span>
<span class="auto-style1">    std::cout &lt;&lt; "b1.name: " &lt;&lt; b1.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b2.name: " &lt;&lt; b2.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b3.name: " &lt;&lt; b3.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b4.name: " &lt;&lt; b4.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b5.name: " &lt;&lt; b5.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b6.name: " &lt;&lt; b6.name &lt;&lt; std::endl;</span>
<span class="auto-style1">    std::cout &lt;&lt; "b7.name: " &lt;&lt; b7.name &lt;&lt; std::endl;</span>

    return 0;
}</pre>

    <p>&nbsp;</p>
    <p>下記コマンドでビルドします。</p>
    
    <pre class="prettyprint" style="width:800px">
$ g++ -std=c++23 -Wall -Wextra -Wpedantic class_template_02.cpp -o class_template_02.out</pre>

    <p>&nbsp;</p>
    <p>実行結果を以下に記載します。</p>
    
    <pre class="prettyprint" style="width:800px">
$ ./class_template_02.out
b1.name: 
b2.name: b1
b3.name: b1
b4.name: default_name
b5.name: default_name
b6.name: b1
b7.name: b1
$ </pre>

    <p>&nbsp;</p>
    <p>厳密な確認ではないですが、期待通りに動作しているであろうことを確認できました。&nbsp;</p>
    <p>&nbsp;</p>
    
  </section>
  
  <p>&nbsp;</p>
  
  <section>
  
    <h2><a name="4._基本の_class_表記_(=_default_無し)">4. 基本の class 表記 ("= default" 無し)</a></h2>
    <h4> [概要]</h4>
    <p> 前章では、<span class="cpp-source">= default</span> を積極利用して class を作ってみました。</p>
    <p> 本章では、同じ内容のプログラムを <span class="cpp-source">= default</span> 
    を使用せずに作成してみます。</p>
    <p>&nbsp;</p>
  
    <h4>[評価環境]</h4>
    	<table>
      	<tbody>
      	  <tr>
      	    <td class="td_separate" colspan="3"></td>
      	  </tr>
      		
      	  <tr>
      	    <td>コンパイラ :</td>
      	    <td>g++,</td>
      	    <td>13.3.0 </td>
      	  </tr>
      		
      	  <tr>
      	    <td class="td_separate" colspan="3"></td>
      	  </tr>
      		
      	  <tr>
      	    <td>OS :</td>
      	    <td>Ubuntu,</td>
      	    <td>24.04 </td>
      	  </tr>
      	  
      	  <tr>
      	    <td class="td_separate" colspan="3"></td>
      	  </tr>
      	</tbody>
    	</table>
    
    <p>&nbsp;</p>
    <p>作成したプログラムを以下に記載します。</p>
    <p>それなりに注意を要するプログラムであることがわかります。</p>
    <p>&nbsp;</p>
    <p>[プログラムソース &quot;class_template_03.cpp&quot;]</p>
    
    <pre class="prettyprint linenums lang-cpp" style="width:800px">
#include &lt;utility&gt;  // std::move
#include &lt;string&gt;
#include &lt;iostream&gt;

class Base {
public:
    std::string name = "default_name";

public:
<span class="auto-style1">    // 明示的な default constructor（元の = default と同等）</span>
<span class="auto-style1">    Base()</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">    }</span>

<span class="auto-style1">    // 明示的な virtual destructor</span>
<span class="auto-style1">    virtual ~Base()</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">    }</span>

<span class="auto-style1">    // 明示的な copy constructor</span>
<span class="auto-style1">    Base(const Base&amp; other)</span>
<span class="auto-style1">        : name(other.name)</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">    }</span>

<span class="auto-style1">    // 明示的な copy operator</span>
<span class="auto-style1">    Base&amp; operator=(const Base&amp; other)</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">        if (this != &amp;other) {</span>
<span class="auto-style1">            name = other.name;</span>
<span class="auto-style1">        }</span>
<span class="auto-style1">        return *this;</span>
<span class="auto-style1">    }</span>

<span class="auto-style1">    // 明示的な move constructor</span>
<span class="auto-style1">    Base(Base&amp;&amp; other) noexcept</span>
<span class="auto-style1">        : name(std::move(other.name))</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">    }</span>

<span class="auto-style1">    // 明示的な move operator</span>
<span class="auto-style1">    Base&amp; operator=(Base&amp;&amp; other) noexcept</span>
<span class="auto-style1">    {</span>
<span class="auto-style1">        if (this != &amp;other) {</span>
<span class="auto-style1">            name = std::move(other.name);</span>
<span class="auto-style1">        }</span>
<span class="auto-style1">        return *this;</span>
<span class="auto-style1">    }</span>
};

int main()
{
    Base b1;                // call 'default constructor'.
    b1.name = "b1";
    Base b2(b1);            // call 'copy constructor'.
    Base b3 = b2;           // call 'copy operator'.
    Base b4(Base{});        // call 'move constructor'.
    Base b5 = Base();       // call 'move operator'.
    
    Base b6;
    b6 = b1;                // call 'copy operator'.
    Base b7;
    b7 = std::move(b1);     // call 'move operator'.

    // 確認
    std::cout &lt;&lt; "b1.name: " &lt;&lt; b1.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b2.name: " &lt;&lt; b2.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b3.name: " &lt;&lt; b3.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b4.name: " &lt;&lt; b4.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b5.name: " &lt;&lt; b5.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b6.name: " &lt;&lt; b6.name &lt;&lt; std::endl;
    std::cout &lt;&lt; "b7.name: " &lt;&lt; b7.name &lt;&lt; std::endl;

    return 0;
}</pre>

    <p>&nbsp;</p>
    <p>下記コマンドでビルドします。</p>
    
    <pre class="prettyprint" style="width:800px">
$ g++ -std=c++23 -Wall -Wextra -Wpedantic class_template_03.cpp -o class_template_03.out</pre>

    <p>&nbsp;</p>
    <p>実行結果を以下に記載します。</p>
    
    <pre class="prettyprint" style="width:800px">
$ ./class_template_03.out
b1.name: 
b2.name: b1
b3.name: b1
b4.name: default_name
b5.name: default_name
b6.name: b1
b7.name: b1
$ </pre>

    <p>&nbsp;</p>
    <p>前章と同じ結果になることを確認できました。</p>
    <p>&nbsp;</p>
  </section>

  <p>&nbsp;</p>
  
  <section>
    <h2><a id="ライセンス">ライセンス</a></h2>
    <p>本ページの情報は、特記無い限り下記 MIT ライセンスで提供されます。</p>
    <div class="license">
      The MIT License (MIT)<br><br>
      
      &nbsp; Copyright 2025 Kinoshita Hidetoshi<br><br>
      
      Permission is hereby granted, free of charge, to any person obtaining a copy
      of this software and associated documentation files (the "Software"), to deal
      in the Software without restriction, including without limitation the rights
      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
      copies of the Software, and to permit persons to whom the Software is
      furnished to do so, subject to the following conditions:<br><br>
      
      The above copyright notice and this permission notice shall be included in all
      copies or substantial portions of the Software.<br><br>
      
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
      SOFTWARE.
    </div>
    <p>&nbsp;</p>
  </section>
  
  <p> &nbsp;</p>
  
  <section>
  	<h2><a id="参考">参考</a></h2>
  	<ul>
  		<li>
        Effective Modern C++, Scott Meyers 著 千住治郎 訳, オライリー・ジャパン, ISBN978-4-87311-736-2</li>
  	</ul>
  </section>
  
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
  	<h2 style="margin-bottom:5px">変更履歴</h2>
  	<table>
  	  <tr>
  	    <td class="td_history_date">2025-11-06</td>
  	    <td class="td_history_separator">-</td>
  	    <td class="td_history">新規作成 </td>
  	  </tr>
  	</table>
  </section>
  
  <p>&nbsp;</p>
  
  <section>
    <p><a href="../../../index.html" target="_parent">Programming Items トップページ</a></p>
    <p><a href="../../../privacy_policy.html">プライバシーポリシー</a></p>
  </section>
  
  <p>&nbsp;</p>
  
  <footer>
  	<p><small>&copy; 2025 Kinoshita Hidetoshi (木下英俊)</small></p>
  </footer>
  
</body>
</html>
