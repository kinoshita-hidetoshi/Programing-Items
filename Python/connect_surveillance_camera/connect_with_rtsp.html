<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="木下英俊">
  <meta name="description" content="木下英俊が自身のためにプログラムメモを残すことを目的に作成したページです。">
  <meta name="keywords" content="">
  <!-- キャッシュ無効化 -->
  <meta http-equiv="Cache-Control" content="no-cache">
	
  <title>RTSPで画像を取得する</title>
	
  <!-- CSS -->
  <link href="https://unpkg.com/ress/dist/ress.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../../design.css" type="text/css">
  
  <!-- Start for 'google-code-prettify' -->
  <link href="../../prettify.css" rel="stylesheet" type="text/css">
  <script src="../../prettify.js" type="text/javascript"></script>
  <!-- End for 'google-code-prettify' -->

</head>

<body onload="prettyPrint();">

<h1>RTSP で画像を取得する</h1>

<p> i-PRO の監視カメラ i-PRO mini (WV-S7130W) から RTSP(H.264/H.265) で映像取得して遊んでみます。</p>

<p>&nbsp;</p>
<table style="border: 1px solid #808080; width: 100%; max-width:800px; background-color: #F0F0F0;">
  <tr>
    <td>
      <nav>
        <h2> 目次</h2>
        <p>
        <a href="#1._CGI_表記仕様">1. CGI 表記仕様</a><br>
        <a href="#2._Python_で_i-PRO_mini_(WV-S7130W)_と接続して映像を表示してみる">2. Python で 
        i-PRO mini (WV-S7130W) と接続して映像を表示してみる</a><br>
        <br>
        <a href="#参考">参考</a><br>
        </p>
      </nav>
    </td>
  </tr>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>

<section>
	<h2> <a name="1._CGI_表記仕様">1. CGI 表記仕様</a></h2>
	<h4>[概要]</h4>
	<p> RTSP で接続するための表記を以下に記載します。</p>
    <p>&nbsp;</p>
    <h3>i-PRO (Panasonic) 従来 model</h3>
    <p><span class="cpp-source">rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/h264/stream_1</span></p>
    <p>&nbsp;</p>
    <p>(例) <span class="cpp-source">
    rtsp://admin:password@192.168.0.10/MediaInput/h264/stream_1</span></p>
    <p>&nbsp;</p>
    <h3>&nbsp;</h3>
    <h3>i-PRO H265 model</h3>
    <p><span class="cpp-source">rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1</span></p>
    <p>&nbsp;</p>
    <p>(例) <span class="cpp-source">
    rtsp://admin:password@192.168.0.10/MediaInput/stream_1</span></p>
    <p>&nbsp;</p>
    
    <h3>i-PRO H265モデル CGI仕様書からの抜粋</h3>
    
    <p>10.6. 汎用ﾋﾞｭｰｱでH.265を見る
以下のURLを使用することで、H.265配信を配信することができます。<br>（圧縮方式をH.265に設定する必要があります。）</p>
    <p>&nbsp;</p>
    <table class="border-collapse" style="width: 1000px">
      <tr>
        <td class="standard_table"><strong>ストリーム(1)</strong></td>
        <td class="standard_table">
        rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(2)</strong></td>
        <td class="standard_table">rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(3)</strong></td>
        <td class="standard_table">rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_3 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(4)</strong></td>
        <td class="standard_table">rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_4 </td>
      </tr>
      </table>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    
    <h3>マルチセンサーカメラ（X8570 / S8530）</h3>
    
    <table class="border-collapse" style="width: 1000px">
      <tr>
        <td class="standard_table"><strong>ストリーム(1) Ch1 (Camera1)/</strong></td>
        <td class="standard_table">
        rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1<br>rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1/ch_1</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(2) Ch1 (Camera1)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2<br>rtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2/ch_1 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(1) Ch2 (Camera2)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1/ch_2 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(2) Ch2 (Camera2)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2/ch_2 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(1) Ch3 (Camera3)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1/ch_3 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(2) Ch3 (Camera3)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2/ch_3 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(1) Ch4 (Camera4)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_1/ch_4 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>ストリーム(2) Ch4 (Camera4)/</strong></td>
        <td class="standard_table">rrtsp://&lt;user-id&gt;:&lt;user-password&gt;@&lt;カメラのIPアドレス&gt;/MediaInput/stream_2/ch_4 </td>
      </tr>
      </table>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h3>以下、i-PRO 以外</h3>
    <p>&nbsp;</p>
    <table class="border-collapse" style="width: 1000px">
      <tr>
        <td class="standard_table"><strong>AXIS</strong></td>
        <td class="standard_table">
        rtsp://&lt;カメラのIPアドレス&gt;/axis-media/media.amp/trackID=1?videocodec=h264<br>
        rtsp://&lt;カメラのIPアドレス&gt;/axis-media/media.amp</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>VIVOTEK</strong></td>
        <td class="standard_table">rtsp://&lt;カメラのIPアドレス&gt;:554/live.sdp/trackID=1</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>BOSCH</strong></td>
        <td class="standard_table">rtsp://&lt;カメラのIPアドレス&gt;/?h26X=4</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>SONY</strong></td>
        <td class="standard_table">rtsp://&lt;カメラのIPアドレス&gt;/media/video1</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>HIKVISION</strong></td>
        <td class="standard_table">
          <p>rtsp://&lt;カメラのIPアドレス&gt;:554</p>
          <p>rtsp://&lt;カメラのIPアドレス&gt;/h264/ch1/main/av_stream</p>
        </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>Arecont Vision</strong></td>
        <td class="standard_table">
        rtsp://&lt;カメラのIPアドレス&gt;:554/h264.sdp?res=half&amp;x0=0&amp;y0=0&amp;x1=3648&amp;y1=2752&amp;qp=20&amp;doublescan=0&amp;bitrate=65535&amp;ssn=20 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>SAMSUNG</strong></td>
        <td class="standard_table">rtsp://&lt;カメラのIPアドレス&gt;/profile2/media.smp<br>
        (profileNo.は表示したいprofileに設定する） </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>pelco</strong></td>
        <td class="standard_table">
        rtsp://&lt;カメラのIPアドレス&gt;/?deviceid=uuid:B11DBF24-7E98-4B9B-B83B-7E74497DE6CA&amp;clientid=123<br>
        rtsp://&lt;カメラのIPアドレス&gt;/stream1 </td>
      </tr>
      <tr>
        <td class="standard_table"><strong>sanyo</strong></td>
        <td class="standard_table">rtsp://&lt;カメラのIPアドレス&gt;/VideoInput/1/h264/1</td>
      </tr>
      <tr>
        <td class="standard_table"><strong>dahua</strong></td>
        <td class="standard_table">
        rtsp://admin:admin@&lt;カメラのIPアドレス&gt;/cam/realmonitor?channel=1&amp;subtype=1<br>※adminはIDとpass</td>
      </tr>
    </table>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
</section>
<p>&nbsp;</p>

<section>
	<h2> <a name="2._Python_で_i-PRO_mini_(WV-S7130W)_と接続して映像を表示してみる">2. Python で i-PRO mini (WV-S7130W) と接続して映像を表示してみる</a></h2>
	<h4>[概要]</h4>
    <p>とりあえず映像を取得してPC画面に表示するまでをやってみます。</p>
	<p> &nbsp;</p>
	
	<h4>[環境]</h4>
	<table>
	<tbody>
	  <tr>
	    <td class="td_separate" colspan="3"></td>
	  </tr>
		
	  <tr>
	    <td>言語 :</td>
	    <td>Python,</td>
	    <td>3.8.10 </td>
	  </tr>
		
	  <tr>
	    <td class="td_separate" colspan="3"></td>
	  </tr>
		
	  <tr>
	    <td>OS :</td>
	    <td>Ubuntu(WSL),</td>
	    <td>20.04</td>
	  </tr>
		
	  <tr>
	    <td class="td_separate" colspan="3"></td>
	  </tr>
	</tbody>
	</table>
	
	<p>&nbsp;</p>
  <p>[プログラムソース &quot;connect_with_rtsp.py&quot;]</p>
  
	<pre class="prettyprint linenums">
'''
[abstract]
    i-PRO mini (WV-S7130W) と接続して映像を表示してみる 
[library install]
 &nbsp; &nbsp;pip install opencv-python 
'''

import cv2
user_id = "admin" 
user_pw = "password" 
host = "192.168.0.10" 
cap = cv2.VideoCapture(f"rtsp://{user_id}:{user_pw}@{host}/MediaInput/stream1")

while(True):
    try:
        ret, frame = cap.read()
        if ret == True:
            frame2 = cv2.resize(frame, (1280, 760))
            cv2.imshow('VIDEO', frame2)

        # コンソール上で ctrl-c を押すとプログラムを終了する。
        # GUI 上で ctrl-c してもプログラムを終了できない。
        cv2.waitKey(1)

    except KeyboardInterrupt:
        print("KeyboardInterrupt")
        break

cap.release()
cv2.destroyAllWindows()</pre>
</section>
	
<br>

<p>&nbsp;</p>
<p>&nbsp;<br>

</p>

<section>
	<h2><a name="参考">参考</a></h2>
	<ul>
		<li>[python] ネットワークカメラの画像を RTSP で取得して表示・保存 - へっぽこプログラマーの備忘録 
        (kuttsun.blogspot.com)<br>
        <a href="https://kuttsun.blogspot.com/2021/08/python-rtsp.html" target="_blank">
        https://kuttsun.blogspot.com/2021/08/python-rtsp.html</a></li>
	</ul>
</section>

<p>&nbsp;</p>
<p>&nbsp;</p>

<hr>

<p>&nbsp;</p>

<section>
	<h2 style="margin-bottom:5px">記載</h2>
	<table>
	  <tr>
	    <td class="td_history_date">2022-03-19</td>
	    <td class="td_history_separator">-</td>
	    <td class="td_history">新規作成 </td>
	  </tr>
	</table>
</section>

<p>&nbsp;</p>

<footer>
	<p><small>&copy; copyright 2022 木下英俊</small></p>
</footer>

</body>
</html>
