<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>[VBA] 複数のシートを操作する</title>

<!-- Start for 'google-code-prettify' -->
<link href="../prettify.css" rel="stylesheet" type="text/css">
<script src="../prettify.js" type="text/javascript"></script>
<!-- End for 'google-code-prettify' -->

<link rel="stylesheet" href="../design.css" type="text/css">
<style type="text/css">
.auto-style7 {
	font-weight: normal;
}
</style>
</head>

<!-- Start for 'google-code-prettify' -->
<body onload="prettyPrint();">
<!-- End for 'google-code-prettify' -->

<h1 class="auto-style7">
[Excel VBA] 複数のシートを操作する</h1>

<p>複数のシートを操作するVBAを作成します。</p>
<p>参考・引用元記事： 日経ソフトウェア 2019年9月号 「ビジネスパーソンの Excel VBA 再入門 第4回 複数のシートを操作しよう」</p>
<p>&nbsp;</p>

<h2> 目次</h2>

<p> <a href="#1._作業日により、月ごとにシートを分割する">1. 作業日により、月ごとにシートを分割する</a><br>
<a href="#2._一覧以外のシートをすべて削除する">2. 一覧以外のシートをすべて削除する</a><br>
<a href="#3._”シート一覧”_シートを作成する">3. ”シート一覧”_シートを作成する</a><br>
<a href="#4._全ソースコード">4. 全ソースコード</a><br>
<a href="#サンプルプログラム">サンプルプログラム</a><br>
<a href="#参考">参考</a></p>

<p> &nbsp;</p>
<h2> <a name="1._作業日により、月ごとにシートを分割する">1. 作業日により、月ごとにシートを分割する</a></h2>
<p> [概要]</p>
<p> &nbsp;</p>
<font face="Meiryo UI">
<p>[評価環境]</p>
<table>
<tbody>
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>Excel :</td>
		<td>Microsoft Office Home and Business 2019,</td>
		<td>&nbsp;</td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>OS: </td>
		<td>Windows10 home,</td>
		<td>Version 1909 </td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
</tbody>
</table>
</font>
<p> &nbsp;</p>
<p> 
<img alt="" src="Work_with_multiple_sheets/img3.jpg"></p>
<p> &nbsp;</p>
<p> <img alt="" src="Work_with_multiple_sheets/img9.gif"></p>
<p> &nbsp;</p>
<p> <img alt="" src="Work_with_multiple_sheets/imgB.jpg"></p>
<p> &nbsp;</p>
<p> &nbsp;</p>

<p>[プログラムソース &quot;sample.xlsm&quot; - Module1]</p>
<!-- Start for 'google-code-prettify' -->
<pre class="prettyprint linenums">
<code>'
' &quot;一覧&quot;シートから作業日を確認して、作業日が2月、3月、4月、のものを&quot;2月分&quot;、&quot;3月分&quot;、&quot;4月分&quot;のシートへコピーする
'
Sub 月分割()
    Dim i
       
    For i = 2 To 4
        ' 2月から4月でフィルタ
        Worksheets(&quot;一覧&quot;).Range(&quot;A2&quot;).AutoFilter field:=3, Criteria1:=i + 20, Operator:=xlFilterDynamic
        
        Worksheets.Add after:=Worksheets(Worksheets.Count)
        ActiveSheet.Name = i &amp; &quot;月分&quot;
        Worksheets(&quot;一覧&quot;).UsedRange.Copy
        
        With Worksheets(i &amp; &quot;月分&quot;).Range(&quot;A1&quot;)
            .PasteSpecial xlPasteColumnWidths
            .PasteSpecial xlPasteAll
        End With
    Next i
    
    With Worksheets(&quot;一覧&quot;)
        .Select
        .ShowAllData
    End With
End Sub</code></pre>
<!-- End for 'google-code-prettify' -->

<p>&nbsp;</p>
<p>&nbsp;</p>
<h2> <a name="2._一覧以外のシートをすべて削除する">2. &quot;一覧&quot;以外のシートをすべて削除する</a></h2>
<p> [概要]</p>
<p> &nbsp;</p>
<font face="Meiryo UI">
<p>[評価環境]</p>
<table>
<tbody>
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>Excel :</td>
		<td>Microsoft Office Home and Business 2019,</td>
		<td>&nbsp;</td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>OS: </td>
		<td>Windows10 home,</td>
		<td>Version 1909 </td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
</tbody>
</table>
</font>
<p> &nbsp;</p>
<p>&nbsp;</p>
<p><img alt="" src="Work_with_multiple_sheets/img14.gif"></p>
<p>&nbsp;</p>

<p>[プログラムソース &quot;sample.xlsm&quot; - Module1]</p>
<!-- Start for 'google-code-prettify' -->
<pre class="prettyprint linenums">
<code>'
' シート名 &quot;一覧&quot; 以外のシートを削除する
'
Sub シート削除()
    Dim sht
    
    Application.DisplayAlerts = False
    
    For Each sht In Worksheets
        If sht.Name &lt;&gt; &quot;一覧&quot; Then
            sht.Delete
        End If
    Next sht
End Sub</code></pre>
<!-- End for 'google-code-prettify' -->

<p>&nbsp;</p>
<p>&nbsp;</p>
<h2> <a name="3._”シート一覧”_シートを作成する">3. ”シート一覧” シートを作成する</a></h2>
<p> [概要]</p>
<p> &nbsp;</p>
<font face="Meiryo UI">
<p>[評価環境]</p>
<table>
<tbody>
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>Excel :</td>
		<td>Microsoft Office Home and Business 2019,</td>
		<td>&nbsp;</td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
	
	<tr>
		<td>OS: </td>
		<td>Windows10 home,</td>
		<td>Version 1909 </td>
	</tr>
	
	<tr>
		<td class="td_separate" colspan="3"></td>
	</tr>
</tbody>
</table>
</font>
<p> &nbsp;</p>
<p>&nbsp;</p>

<p> <img alt="" src="Work_with_multiple_sheets/imgC.gif"></p>
<p> &nbsp;</p>
<p> &nbsp;</p>
<p> <img alt="" src="Work_with_multiple_sheets/img11.jpg"></p>
<p> &nbsp;</p>
<p> &nbsp;</p>
<h2> <a name="4._全ソースコード">4. 全ソースコード</a></h2>

<p>[プログラムソース &quot;sample.xlsm&quot; - Module1]</p>
<!-- Start for 'google-code-prettify' -->
<pre class="prettyprint linenums">
<code>'
' &quot;シート一覧&quot; を作成する
'
Sub シート一覧()
    Dim i
    
    Application.DisplayAlerts = False
    
    ' もし &quot;シート一覧&quot; シートがあったら削除
    If IsExistSheet_Object(&quot;シート一覧&quot;) = True Then
        ' &quot;シート一覧&quot; シートがあるので削除
        Worksheets(&quot;シート一覧&quot;).Delete
    End If
    
    Worksheets.Add before:=Worksheets(1)
    ActiveSheet.Name = &quot;シート一覧&quot;
    
    With Worksheets(&quot;シート一覧&quot;)
        .Cells(1, &quot;A&quot;) = &quot;番号&quot;
        .Cells(1, &quot;B&quot;) = &quot;シート名&quot;
        
        For i = 1 To Worksheets.Count
            .Cells(i + 1, &quot;A&quot;) = i
            .Cells(i + 1, &quot;B&quot;) = Worksheets(i).Name
            .Hyperlinks.Add anchor:=.Cells(i + 1, &quot;B&quot;), Address:=&quot;&quot;, SubAddress:=Worksheets(i).Name &amp; &quot;!A1&quot;
        Next i
        
        .Columns.AutoFit
        .Range(.Cells(1, &quot;A&quot;), .Cells(1, &quot;B&quot;)).Interior.ColorIndex = 15
        .UsedRange.Borders.LineStyle = xlContinuous
        
    End With
    
End Sub


'
' &quot;指定したシート名&quot; のシートの有無を確認する
' True   : ある
' False  : ない
'
'Public Function IsExistSheet_Object(checkBookNm As String, checkSheetNm As String) As Boolean
Public Function IsExistSheet_Object(checkSheetNm As String) As Boolean
 
    Dim targetSheet As Worksheet    '対象シートをセットする変数
    Dim ret         As Boolean      'チェック結果
    
    'エラー無視
    On Error Resume Next
    
    'オブジェクト変数に、対象シートをセットする
    'Set targetSheet = Workbooks(checkBookNm).Worksheets(checkSheetNm)
    Set targetSheet = Worksheets(checkSheetNm)
    
    'エラー無視を解除
    On Error GoTo 0
    
    'オブジェクト変数に、シートがセットされているかどうかで存在を判定
    If targetSheet Is Nothing Then
        ret = False
    Else
        ret = True
    End If
 
    '存在チェックの結果を返す
    IsExistSheet_Object = ret
    
End Function</code></pre>
<!-- End for 'google-code-prettify' -->

<p>&nbsp;</p>

<p> &nbsp;</p>
<p> &nbsp;</p>

<p>[プログラムソース &quot;sample.xlsm&quot; - 全体]</p>
<!-- Start for 'google-code-prettify' -->
<pre class="prettyprint linenums">
<code>'
' &quot;一覧&quot;シートから作業日を確認して、作業日が2月、3月、4月、のものを&quot;2月分&quot;、&quot;3月分&quot;、&quot;4月分&quot;のシートへコピーする
'
Sub 月分割()
    Dim i
       
    For i = 2 To 4
        ' 2月から4月でフィルタ
        Worksheets(&quot;一覧&quot;).Range(&quot;A2&quot;).AutoFilter field:=3, Criteria1:=i + 20, Operator:=xlFilterDynamic
        
        Worksheets.Add after:=Worksheets(Worksheets.Count)
        ActiveSheet.Name = i &amp; &quot;月分&quot;
        Worksheets(&quot;一覧&quot;).UsedRange.Copy
        
        With Worksheets(i &amp; &quot;月分&quot;).Range(&quot;A1&quot;)
            .PasteSpecial xlPasteColumnWidths
            .PasteSpecial xlPasteAll
        End With
    Next i
    
    With Worksheets(&quot;一覧&quot;)
        .Select
        .ShowAllData
    End With
End Sub


'
' シート名 &quot;2月分&quot;、&quot;3月分&quot;、&quot;4月分&quot; の３つのシートを削除する
'
Sub シート削除()
    Dim sht
    
    Application.DisplayAlerts = False
    
    For Each sht In Worksheets
        If sht.Name &lt;&gt; &quot;一覧&quot; Then
            sht.Delete
        End If
    Next sht
End Sub


'
' &quot;シート一覧&quot; を作成する
'
Sub シート一覧()
    Dim i
    
    Application.DisplayAlerts = False
    
    ' もし &quot;シート一覧&quot; シートがあったら削除
    If IsExistSheet_Object(&quot;シート一覧&quot;) = True Then
        ' &quot;シート一覧&quot; シートがあるので削除
        Worksheets(&quot;シート一覧&quot;).Delete
    End If
    
    Worksheets.Add before:=Worksheets(1)
    ActiveSheet.Name = &quot;シート一覧&quot;
    
    With Worksheets(&quot;シート一覧&quot;)
        .Cells(1, &quot;A&quot;) = &quot;番号&quot;
        .Cells(1, &quot;B&quot;) = &quot;シート名&quot;
        
        For i = 1 To Worksheets.Count
            .Cells(i + 1, &quot;A&quot;) = i
            .Cells(i + 1, &quot;B&quot;) = Worksheets(i).Name
            .Hyperlinks.Add anchor:=.Cells(i + 1, &quot;B&quot;), Address:=&quot;&quot;, SubAddress:=Worksheets(i).Name &amp; &quot;!A1&quot;
        Next i
        
        .Columns.AutoFit
        .Range(.Cells(1, &quot;A&quot;), .Cells(1, &quot;B&quot;)).Interior.ColorIndex = 15
        .UsedRange.Borders.LineStyle = xlContinuous
        
    End With
    
End Sub


'
' &quot;指定したシート名&quot; のシートの有無を確認する
' True   : ある
' False  : ない
'
'Public Function IsExistSheet_Object(checkBookNm As String, checkSheetNm As String) As Boolean
Public Function IsExistSheet_Object(checkSheetNm As String) As Boolean
 
    Dim targetSheet As Worksheet    '対象シートをセットする変数
    Dim ret         As Boolean      'チェック結果
    
    'エラー無視
    On Error Resume Next
    
    'オブジェクト変数に、対象シートをセットする
    'Set targetSheet = Workbooks(checkBookNm).Worksheets(checkSheetNm)
    Set targetSheet = Worksheets(checkSheetNm)
    
    'エラー無視を解除
    On Error GoTo 0
    
    'オブジェクト変数に、シートがセットされているかどうかで存在を判定
    If targetSheet Is Nothing Then
        ret = False
    Else
        ret = True
    End If
 
    '存在チェックの結果を返す
    IsExistSheet_Object = ret
    
End Function</code>
</pre>
<!-- End for 'google-code-prettify' -->

<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>
<a name="サンプルプログラム">サンプルプログラム</a></h2>
<p>
サンプルプログラム <a href="Work_with_multiple_sheets/sample.xlsm">ダウンロード</a></p>
<p>
&nbsp;</p>
<h2>
<a name="参考">参考</a></h2>
<ul>
	<li>(例) http://www.****.com</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p> <font face="Meiryo UI">記載： 木下英俊<br>2020/05/05 新規作成</font></p>
</body>
</html>
