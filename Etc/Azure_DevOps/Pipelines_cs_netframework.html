<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="kinoshita hidetoshi (木下 英俊)">
  <meta name="description" content="木下英俊が自身のためにプログラムメモを残すことを目的に作成したページです。">
  <meta name="keywords" content="">
  <!-- キャッシュ無効化 -->
  <meta http-equiv="Cache-Control" content="no-cache">
	
  <!-- タイトル -->
  <title>[Azure DevOps] c#(.NET Framework) を Pipelines する | Programming Items</title>
	
  <!-- ファビコン -->
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <!-- CSS -->
  <link href="https://unpkg.com/ress/dist/ress.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../../design.css" type="text/css">
  
	<!-- Start for 'google-code-prettify' -->
	<link href="../../prettify/styles/desert.css" rel="stylesheet" type="text/css">
	<script src="../../prettify/prettify.js" type="text/javascript"></script>
	<script src="../../prettify/lang-yml.js" type="text/javascript"></script>
	<!-- End for 'google-code-prettify' -->	
	
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V2DZQK54C2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-V2DZQK54C2');
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->

  <style type="text/css">
  .auto-style1 {
    text-decoration: underline;
  }
  .auto-style2 {
    background-color: #505000;
  }
  </style>

</head>

<body onload="prettyPrint();">
  
  <h1>[Azure DevOps] c#(.NET Framework) を Pipelines する </h1>

  <p> 今更ながら Azure DevOps 環境で c# (.NET Framework) アプリを CI/CD 
  してみたいと思いまして、トライした内容をこちらで記載してみたいと思います。</p>
  <p> &nbsp;</p>
  
  <div class="mokuji">
    <nav>
    	<h2>目次</h2>
    	<p><a href="#1._環境準備">1. 環境準備</a></p>
    	<p><a href="#2._Pipeline_を作成">2. Pipeline を作成</a></p>
    	<p><a href="#3._ビルド生成物（artifacts）を登録する">3. ビルド生成物（artifacts）を登録する</a></p>
      <p><a href="#4._ビルド生成物（artifacts）を_zip_圧縮して登録する">4. ビルド生成物（artifacts）を zip 圧縮して登録する</a></p>
      <p><a href="#5._Unit_テストを実行する">5. Unit テストを実行する</a></p>
      <p><a href="#6._カバレッジ計測">6. カバレッジ計測</a></p>
      <p><a href="#7._OpenCover_でカバレッジ計測">7. OpenCover でカバレッジ計測</a></p>
      <p>&nbsp;&nbsp; <a href="#7.1._ローカルPCで_OpenCover">7-1. ローカルPCで_OpenCover</a></p>
      <p>&nbsp;&nbsp; <a href="#7.2._Azure_DevOps_で_OpenCover">7-2. Azure DevOps で OpenCover</a></p>
    	<p>&nbsp;</p>
    	<p><a href="#ライセンス">ライセンス</a></p>
    	<p><a href="#参考">参考</a></p>
    </nav>
  </div>
  
  <p>&nbsp;</p>
  <p>&nbsp;</p>

  <section>
  	<h2><a name="1._環境準備">1. 環境準備</a></h2>
    <p>&nbsp;</p>
  	<section>
  	  <h3>1.1. "Azure DevOps" に Git プロジェクトを作成</h3>
      <p>"Azure DevOps" のアカウントを既に所有しているものとして記載します。</p>
      <p>&nbsp;</p>
      <p class="auto-style1"><strong>Step 1</strong></p>
      <p>［+ New Project］ボタンをクリックします。</p>
      <p>
      <img alt="+ New Project" class="border" src="Pipelines_cs_netframework/img13.jpg" width="800"></p>
      <p>&nbsp;</p>
      <p class="auto-style1"><strong>Step 2</strong></p>
      <p>"Procjet name" など必要事項を記入および選択後、［Create］ボタンをクリックします。</p>
      <p>私はこの後で超簡単な Counter プログラムを作成してリポジトリへ登録する予定なので、"Project name" を Counter 
      として作成します。</p>
      <p>
      <img alt="Create New Project" class="border" src="Pipelines_cs_netframework/img16.jpg" width="600"></p>
      <p>&nbsp;</p>
      <p>下図はプロジェクト作成完了直後の画面です。</p>
      <p>
      <img alt="プロジェクト作成直後の画面" class="border" src="Pipelines_cs_netframework/img18.jpg" width="800"></p>
      <p>&nbsp;</p>
	  </section>
	
    <p>&nbsp;</p>
    
    <section>
  	  <h3>1.2. c# (.NET Framework 4.8) プロジェクトを作成</h3>
      <p>Pipeline を実行する対象となるプロジェクトを作成します。</p>
      <p>ここでは以下のようなテストプロジェクトを作成して進めました。</p>
      <p>&nbsp;</p>
      <p class="auto-style1"><strong>Step 1</strong></p>
      <p>先ほど作成した Git プロジェクト（Counter）を Clone します。</p>
      <p>下図あたりの表示にあるコマンドを使ったり、画面上のボタン操作を行うことで git clone します。</p>
      <p>
      <img alt="git clone" class="border" src="Pipelines_cs_netframework/img21.jpg" width="800"></p>
      <p>&nbsp;</p>
      <p class="auto-style1"><strong>Step 2</strong></p>
      <p>Clone した場所へ Visual Studio で新しい c# プロジェクトを作成します。</p>
      <p>私は以下のような環境で c# プロジェクトを作成しました。</p>
      <p>&nbsp;</p>
	
	<p><strong>[環境]</strong></p>
      
    	<table>
    	<tbody>
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>コンパイラ :</td>
    	      <td>Visual Studio 2022,</td>
    	      <td>Version 17.8.4 </td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>開発言語:</td>
    	      <td>c#</td>
    	      <td>&nbsp;</td>
    	  </tr>
    	  
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    	  
    	  <tr>
    	    <td>フレームワーク：</td>
    	      <td>.NET Framework 4.8</td>
    	      <td>&nbsp;</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>テストフレームワーク：</td>
    	      <td>MSTest.TestAdapter,</td>
    	      <td>3.1.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>MSTest.TestFramework,</td>
    	      <td>3.1.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>NUnit,</td>
    	      <td>4.0.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>NUnit3TestAdapter,</td>
    	      <td>4.5.0</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>OS :</td>
    	    <td>Windows11 home,</td>
    	    <td>23H2</td>
    	  </tr>
    	  
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    	</tbody>
    	</table>
	
      <p>&nbsp;</p>
    
    <div class="status_warning">
      <div></div>
      <div>
        <p><strong>重要</strong></p>
        <p>上記「テストフレームワーク」に記載の４つは、必ず <strong>NuGet</strong> で登録を行います。</p>
        <p><strong>NuGet</strong> 以外の方法で環境に登録すると、後述の Pipelines 
        で期待する動作をすることが難しくなります。</p>
      </div>
    </div>

      <p>&nbsp;</p>
      <p>
      <img alt="NuGet パッケージ" class="border" src="Pipelines_cs_netframework/img3.jpg" width="800"></p>
      <p>&nbsp;</p>
      <p>代表的な Unit テストフレームワーク（NUnit、MSTestV1、MSTestV2）についても準備して動作を評価してみます。</p>
      <p>&nbsp;</p>
        
    <table class="border-collapse" border="1" width="600">
      <caption>[table.] 各プロジェクトの説明</caption>
      <thead class="standard_table">
        <tr>
          <th style="white-space:nowrap">プロジェクト名</th>
          <th>内容</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>CounterDll</td>
          <td>値（Integer）を管理する class Counter を提供する dll。<br>class Couter 
          は、Increment, Decrement, Clear ３つのメソッドを持つ。</td>
        </tr>
        <tr>
          <td>CounterForm</td>
          <td>class Counter を使った WinForm アプリ。</td>
        </tr>
        <tr>
          <td>CounterWPF</td>
          <td>class Counter を使った WPF アプリ。</td>
        </tr>
        <tr>
          <td>testCounter1</td>
          <td>CounterDll をテストする。NUnt 版。</td>
        </tr>
        <tr>
          <td>testCounter2</td>
          <td>CounterDll をテストする。MSTestV1 版。</td>
        </tr>
        <tr>
          <td>testCounter3</td>
          <td>CounterDll をテストする。MSTestV2 版。</td>
        </tr>
      </tbody>
    </table>
    
      <p>&nbsp;</p>
      <p>Visual Studio 上の画面の様子です。</p>
      <p>
      <img alt="Visual Studio" class="border_with_drop-shadow" src="Pipelines_cs_netframework/img4.jpg" width="800"></p>
      <p>&nbsp;</p>
      <p>図： CounterForm 画面例</p>
      <p>
      <img alt="CounterForm" src="Pipelines_cs_netframework/imgE.jpg" width="400" class="border_with_drop-shadow"></p>
      <p>&nbsp;</p>
      <p>図： CounterWPF 画面例</p>
      <p>
      <img alt="CounterWPF" src="Pipelines_cs_netframework/imgD.jpg" width="400" class="border_with_drop-shadow"></p>
        
      <p>&nbsp;</p>
    </section>
    
    <p>&nbsp;</p>
    
    <section>
  	  <h3>1.3. Git リポジトリへプロジェクトをコミット＆プッシュ</h3>
      <p>Git (Azure DevOps) へコミット＆プッシュします。手順については本ページの主たる内容から外れるので記載を割愛します。</p>
      <p>コミット＆プッシュ後の Azure DevOps 画面です。</p>
      <p>
      <img alt="Azure DevOps 画面" class="border" src="Pipelines_cs_netframework/img12.jpg" width="800"></p>
    </section>
    
    <p>&nbsp;</p>
    
    <p>以上で Pipelines を操作する前の事前準備を完了です。</p>
  </section>

  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
  	<h2><a name="2._Pipeline_を作成">2. Pipeline を作成</a></h2>
    <p>Pipeline を作成していきます。</p>
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 1</strong></p>
    <p>画面左側の Pipeline ボタンをクリックすると下図のような画面を表示するので、［Create Pipeline］ボタンをクリックします。</p>
    <p>
    <img alt="Pipeline" class="border" src="Pipelines_cs_netframework/img17.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 2</strong></p>
    <p>Pipeline の対象となるソースコードの所在を選択します。本ページでは "Azure Repos Git" を選択します。</p>
    <p>
    <img alt="Where is your code?" class="border" src="Pipelines_cs_netframework/img19.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 3</strong></p>
    <p>対象リポジトリを選択します。ここでは Counter を選択します。</p>
    <p>
    <img alt="Select repository" src="Pipelines_cs_netframework/img1E.jpg" class="border" width="800"></p>
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 4</strong></p>
    <p>Pipeline を構成するプラットフォームを選択します。ここでは「<strong>.NET Desktop</strong>」を選択します。</p>
    <p>
    <img alt="Configure your pipeline" class="border" src="Pipelines_cs_netframework/img22.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 5</strong></p>
    <p>"azure-pipelines.yml" ファイルを生成してリポジトリへコミットされました。</p>
    <p>内容を確認して必要に応じて修正します。まずは内容を確認してみましょう。</p>
    <p>
    <img alt="Review your pipeline YAML" class="border" src="Pipelines_cs_netframework/img24.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>生成された yml ファイルのコードは以下のとおりです。</p>
    <p>(1)NuGet パッケージの復元して、(2)ビルドして、(3)ユニットテストする、というような流れです。</p>
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
# .NET Desktop 
# Build and run tests for .NET Desktop or Windows classic desktop solutions. 
# Add&nbsp;steps&nbsp;that&nbsp;publish&nbsp;symbols,&nbsp;save&nbsp;build&nbsp;artifacts,&nbsp;and&nbsp;more: 
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger: 
-&nbsp;main

pool:
 &nbsp;vmImage:&nbsp;'windows-latest'

variables:
&nbsp;&nbsp;solution:&nbsp;'**/*.sln'
&nbsp;&nbsp;buildPlatform:&nbsp;'Any&nbsp;CPU'
&nbsp;&nbsp;buildConfiguration:&nbsp;'Release'

steps: 
-&nbsp;task:&nbsp;NuGetToolInstaller@1

-&nbsp;task:&nbsp;NuGetCommand@2
&nbsp;&nbsp;inputs:
 &nbsp;&nbsp;&nbsp;restoreSolution:&nbsp;'$(solution)'

-&nbsp;task:&nbsp;VSBuild@1
&nbsp;&nbsp;inputs:
&nbsp;&nbsp;&nbsp;&nbsp;solution:&nbsp;'$(solution)'
&nbsp;&nbsp;&nbsp;&nbsp;platform:&nbsp;'$(buildPlatform)'
&nbsp;&nbsp;&nbsp;&nbsp;configuration:&nbsp;'$(buildConfiguration)'

-&nbsp;task:&nbsp;VSTest@2
&nbsp;&nbsp;inputs:
&nbsp;&nbsp;&nbsp;&nbsp;platform:&nbsp;'$(buildPlatform)'
&nbsp;&nbsp;&nbsp;&nbsp;configuration:&nbsp;'$(buildConfiguration)'
</pre>
    <p>&nbsp;</p>
    <p>一部について説明します。</p>
        
    <table class="border-collapse" border="1" width="1000">
      <caption></caption>
      <thead class="standard_table">
        <tr>
          <th style="white-space:nowrap">要素</th>
          <th>内容</th>
          <th>備考</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>trigger</td>
          <td>CI トリガーを取得するブランチを設定します。</td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops&amp;tabs=yaml#branches" target="_blank">https://learn.microsoft.com/ja-jp/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops&amp;tabs=yaml#branches</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td>vmImage</td>
          <td>ビルドするプラットフォームを設定します。Microsoft によってホストされるエージェントから指定します。</td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/customize-pipeline?view=azure-devops" target="_blank">
            パイプラインをカスタマイズする - Azure Pipelines | Microsoft Learn</a></li>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/agents/hosted?view=azure-devops&amp;tabs=yaml" target="_blank">
            Azure Pipelines 用の Microsoft ホステッド エージェント - Azure Pipelines | 
            Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td style="white-space:nowrap">NuGetToolInstaller@1</td>
          <td>インターネットまたはツール キャッシュから特定のバージョンの NuGet を取得し、PATH に追加します。 
          このタスクを使用して、NuGet タスクで使用される NuGet のバージョンを変更します。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/nuget-tool-installer-v1?view=azure-pipelines" target="_blank">
            NuGetToolInstaller@1 - NuGet ツール インストーラー v1 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td>NuGetCommand@2</td>
          <td>このタスクを使用して、NuGet パッケージの復元、パック、プッシュ、または NuGet コマンドの実行を行います。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/nuget-command-v2?view=azure-pipelines" target="_blank">
            NuGetCommand@2 - NuGet v2 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td>VSBuild@1</td>
          <td>このタスクを使用して MSBuild を使用してビルドし、Visual Studio バージョン プロパティを設定します。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/vsbuild-v1?view=azure-pipelines" target="_blank">
            VSBuild@1 - Visual Studio ビルド v1 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td>VSTest@2</td>
          <td>このタスクを使用して、Visual Studio テスト (VSTest) ランナーを使用して単体テストと機能テスト 
          (Selenium、Appium、コード化された UI テストなど) を実行します。 Visual Studio テスト 
          アダプターを持つテスト フレームワークを実行できます。<br>
          フレームワークの例としては、MSTest、xUnit、NUnit、Chutzpah (QUnit、Mocha、Jasmine を使用する 
          JavaScript テスト用) などがあります。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/vstest-v2?view=azure-pipelines" target="_blank">
            VSTest@2 - Visual Studio Test v2 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
      </tbody>
    </table>
    
    <p>&nbsp;</p>
    <p class="auto-style1"><strong>Step 6</strong></p>
    <p>いよいよ［Save and run］してみます。下図［Save and run］ボタンをクリックします。</p>
    <p>
    <img alt="Save and run" class="border" src="Pipelines_cs_netframework/img37.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>下図画面を表示するので、もう一度［Save and run］ボタンをクリックします。</p>
    <p>
    <img alt="Save and run" class="border" src="Pipelines_cs_netframework/img39.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>Pipeline を実行開始しました。</p>
    <p>
    <img alt="Running jobs" class="border" src="Pipelines_cs_netframework/img3B.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>Pipeline を正常に完了ました。完了後の画面を以下に示します。</p>
    <p>
    <img alt="Build succeeded" class="border" src="Pipelines_cs_netframework/img3F.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>「✔ Job」のあたりをクリックすることで Job 詳細を確認することができます。</p>
    <p>どうやら Pipeline は全て正常に処理できたようです。</p>
    <p>
    <img alt="Jobs in run" class="border" src="Pipelines_cs_netframework/img41.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>以上から確認できたとりあえずの課題を以下に列挙します。</p>
    <p>課題：</p>
    <ol>
      <li>ビルド生成物（artifacts）を登録できていない。<br>「0 artifacts」 
      という表示がありますが、ちゃんと設定できるとここからビルド生成物などを取得できるようになります。</li>
      <li>Unitテストを実施できていない。<strong><br>Warnings</strong> がありますね。どうやら、VSTest 
      の対象を見つけることができなかった、という内容のようです。<br>少なくともデフォルト状態では "**\bin\**\*test.dll, 
      **\bin\**\*tests.dll" というファイル名を満足する必要があるようです。</li>
    </ol>
    <p>&nbsp;</p>
    <p>次章からこれら課題を順に解決していきます。</p>
  </section>
  
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="3._ビルド生成物（artifacts）を登録する">3. ビルド生成物（artifacts）を登録する</a></h2>
    <p>ビルド生成物（artifacts）を登録するように yml ファイルを修正します。</p>
    <p>使用するコマンドは下記の２つです。</p>
    <ul>
      <li>CopyFiles@2</li>
      <li>PublishBuildArtifacts@1</li>
    </ul>
    <p>CopyFiles@2 で登録したいファイルを一か所に集めて、PublishBuildArtifacts@1 
    でアーティファクト登録する、というような手順です。</p>
    <p>&nbsp;</p>
    <p>他：</p>
    <ul>
      <li>前回コードからの差分箇所に色付けしています。</li>
      <li>*.pdb ファイルを除外しています。<br>意図的に２つの記載方法を試しています。</li>
    </ul>
    <p>&nbsp;</p>
        
    <table class="border-collapse" border="1" width="1000">
      <caption></caption>
      <thead class="standard_table">
        <tr>
          <th style="white-space:nowrap">要素</th>
          <th>内容</th>
          <th>備考</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>CopyFiles@2</td>
          <td>一致パターンを使用してソース フォルダーからターゲット フォルダーにファイルをコピーします。 (一致パターンは、フォルダー 
          パスではなく、ファイル パスにのみ一致します)。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/copy-files-v2?view=azure-pipelines&amp;tabs=yaml" target="_blank">
            CopyFiles@2 - ファイル v2 タスクをコピーする | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td style="white-space:nowrap">PublishBuildArtifacts@1</td>
          <td>ビルド パイプラインでこのタスクを使用して、ビルド成果物を Azure Pipelines、TFS、またはファイル共有に発行します。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/publish-build-artifacts-v1?view=azure-pipelines" target="_blank">
            PublishBuildArtifacts@1 - ビルド成果物 v1 タスクを発行する | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
      </tbody>
    </table>
    
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
# .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: VSTest@2
  inputs:
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

<span class="auto-style2">- task: CopyFiles@2</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    contents: CounterWPF\bin\$(buildConfiguration)\**\!(*.pdb)</span>
<span class="auto-style2">    targetFolder: $(Build.ArtifactStagingDirectory)</span>

<span class="auto-style2">- task: CopyFiles@2</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    contents: |</span>
<span class="auto-style2">      CounterForm\bin\$(buildConfiguration)\*.*</span>
<span class="auto-style2">      !**\*.pdb</span>
<span class="auto-style2">    targetFolder: $(Build.ArtifactStagingDirectory)</span>

<span class="auto-style2">- task: PublishBuildArtifacts@1</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    pathToPublish: $(Build.ArtifactStagingDirectory)</span>
<span class="auto-style2">    artifactName: 'MyBuildOutputs'</span>
<span class="auto-style2">    publishLocation: 'Container'</span></pre>
    <p>&nbsp;</p>
        
    <p>Pipeline 実行完了後の画面です。「<strong>1 published</strong>」に変わりました。</p>
    <p>
    <img alt="Summary" class="border" src="Pipelines_cs_netframework/img4A.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>「<strong>1 published</strong>」あたりの画面をクリックすると下図 Artifacts 画面を表示します。</p>
    <p>[･･･] ボタンウォリックすることであなたが希望する Artifacts をダウンロードなどすることができます。</p>
    <p>
    <img alt="Artifacts" class="border" src="Pipelines_cs_netframework/img4D.jpg" width="800">&nbsp;</p>
    <p>&nbsp;</p>
  </section>
  
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="4._ビルド生成物（artifacts）を_zip_圧縮して登録する">4. ビルド生成物（artifacts）を zip 圧縮して登録する</a></h2>
    <p>前章では Artifacts 
    として各ファイルを保存する例を紹介しました。しかしながら実際の運用ではアプリケーションは多くのファイルから構成されており、個別ファイルよりも必要となるファイル一式を 
    zip などで圧縮したものを Artifacts として登録する方が都合が良い場合が多いと考えます。</p>
    <p>本章では、事前に zip 圧縮したビルド生成物（artifacts）を登録するように yml ファイルを修正します。</p>
    <p>使用するコマンドは下記の２つです。</p>
    <ul>
      <li>ArchiveFiles@2</li>
      <li>PublishBuildArtifacts@1</li>
    </ul>
    <p>ArchiveFiles@2 でフォルダをまとめて zip 圧縮して、PublishBuildArtifacts@1 
    でアーティファクト登録する、というような手順です。</p>
    <p>&nbsp;</p>
    <p>他：</p>
    <ul>
      <li>下記例では、変数 $(<a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/build/variables?view=azure-devops&amp;tabs=yaml#build-variables-devops-services" target="_blank">Build.BuildId</a>) 
      を使って zip ファイル名に Pipelines のビルドIDを追加しています。</li>
    </ul>
    <p>&nbsp;</p>
        
    <table class="border-collapse" border="1" width="1000">
      <caption></caption>
      <thead class="standard_table">
        <tr>
          <th style="white-space:nowrap">要素</th>
          <th>内容</th>
          <th>備考</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ArchiveFiles@2 </td>
          <td>.7z、.tar、.gz、.zipなどの圧縮形式を使用してファイルをアーカイブします。</td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/archive-files-v2?view=azure-pipelines" target="_blank">
            ArchiveFiles@2 - アーカイブ ファイル v2 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
        <tr>
          <td style="white-space:nowrap">PublishBuildArtifacts@1</td>
          <td>ビルド パイプラインでこのタスクを使用して、ビルド成果物を Azure Pipelines、TFS、またはファイル共有に発行します。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/publish-build-artifacts-v1?view=azure-pipelines" target="_blank">
            PublishBuildArtifacts@1 - ビルド成果物 v1 タスクを発行する | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
      </tbody>
    </table>
    
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
# .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: VSTest@2
  inputs:
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

<span class="auto-style2">- task: ArchiveFiles@2</span>
<span class="auto-style2">  displayName: "Archive files"</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    rootFolderOrFile: CounterWPF\bin\$(buildConfiguration)</span>
<span class="auto-style2">    includeRootFolder: true</span>
<span class="auto-style2">    archiveType: 'zip'</span>
<span class="auto-style2">    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'</span>

<span class="auto-style2">- task: PublishBuildArtifacts@1</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'</span>
<span class="auto-style2">    artifactName: 'MyBuildOutputs - zip'</span>
<span class="auto-style2">    publishLocation: Container</span>

<span class="auto-style2">- task: ArchiveFiles@2</span>
<span class="auto-style2">  displayName: "Archive files"</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    rootFolderOrFile: CounterForm\bin\$(buildConfiguration)</span>
<span class="auto-style2">    includeRootFolder: true</span>
<span class="auto-style2">    archiveType: 'zip'</span>
<span class="auto-style2">    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'</span>

<span class="auto-style2">- task: PublishBuildArtifacts@1</span>
<span class="auto-style2">  inputs:</span>
<span class="auto-style2">    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'</span>
<span class="auto-style2">    artifactName: 'MyBuildOutputs - zip'</span>
<span class="auto-style2">    publishLocation: Container</span></pre>
    <p>&nbsp;</p>
    <p>Pipelines 実行完了後の Artifacts 画面の様子は以下の通りです。</p>
    <p>
    <img alt="Artifacts" class="border" src="Pipelines_cs_netframework/imgE1.jpg" width="800"></p>
    <p>&nbsp;</p>
  </section>

  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="5._Unit_テストを実行する">5. Unit テストを実行する</a></h2>
    <p>Unitテストを実行できるようにします。</p>
    <p>現在の Warnings メッセージを見るとテスト用 dll 
    のファイル名を変更するだけでもある程度動作しそうですが、任意のファイル名でテストできる方が今後の応用のためにも良いでしょう。そんな方向で進めてみます。</p>
    <p>&nbsp;</p>
    <p>
    <img alt="VSTest Warnings" class="border" src="Pipelines_cs_netframework/img14.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>具体的には、<strong>VSTest@2</strong> の <strong>inputs</strong> にて <strong>
    testAssemblyVer2</strong> という要素でテストアセンブリを具合的に指定することで解決できました。<br>詳細は下記例を参照ください。</p>
        
    <table class="border-collapse" border="1" width="1000">
      <caption></caption>
      <thead class="standard_table">
        <tr>
          <th style="white-space:nowrap">要素</th>
          <th>内容</th>
          <th>備考</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>VSTest@2</td>
          <td>このタスクを使用して、Visual Studio テスト (VSTest) ランナーを使用して単体テストと機能テスト 
          (Selenium、Appium、コード化された UI テストなど) を実行します。 Visual Studio テスト 
          アダプターを持つテスト フレームワークを実行できます。<br>
          フレームワークの例としては、MSTest、xUnit、NUnit、Chutzpah (QUnit、Mocha、Jasmine を使用する 
          JavaScript テスト用) などがあります。 </td>
          <td>
          <ul>
            <li>
            <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/tasks/reference/vstest-v2?view=azure-pipelines" target="_blank">
            VSTest@2 - Visual Studio Test v2 タスク | Microsoft Learn</a></li>
          </ul>
          </td>
        </tr>
      </tbody>
    </table>
    
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
# .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: VSTest@2
  inputs:
<span class="auto-style2">    testAssemblyVer2: |</span>
<span class="auto-style2">      **\$(BuildConfiguration)\testCounter1.dll</span>
<span class="auto-style2">      **\$(BuildConfiguration)\testCounter2.dll</span>
<span class="auto-style2">      **\$(BuildConfiguration)\testCounter3.dll</span>
<span class="auto-style2">      !**\obj\**</span>
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterWPF\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterForm\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container</pre>
    <p>&nbsp;</p>
    <p>以下、Pipelines 実行後の画面です。</p>
    <p>Warnings が消えました。</p>
    <p>
    <img alt="Summary" class="border" src="Pipelines_cs_netframework/img20.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>16個のテストを実行して全てをパスしたことがわかります。</p>
    <p>VSTest@2 で NUnit, MSTestV1, MSTestV2 を全部実行してくれたことがうれしい感じでした。</p>
    <p>
    <img alt="Tests" class="border" src="Pipelines_cs_netframework/img23.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>"Code Coverage" は空でした。</p>
    <p>
    <img alt="Code Coverage" class="border" src="Pipelines_cs_netframework/img1A.jpg" width="800"></p>
    <p>&nbsp;</p>
    <p>次章ではこの "Code Coverage" を有効化してみたいと思います。</p>
    <p>&nbsp;</p>
  
    <div class="status_information">
      <div></div>
      <div>
        <p><strong>参考</strong></p>
        <p>VSTest@2 は恐らく "vstest.console.exe" だと思われます。<br>ローカルPC上のコンソールにて下記コマンドにより同様に16個のテストを実行して同じ結果を得らえました。</p>
        <blockquote>
          vstest.console.exe ./testCounter*/bin/debug/testCounter*.dll
        </blockquote>
      </div>
    </div>

  </section>

  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="6._カバレッジ計測">6. カバレッジ計測</a></h2>
    <p>コード カバレッジは、ソースがどれくらいテストされているかを確認するのに役立つ指標および手法やツールのことを意味します。</p>
    <p>本章では、前章で空だった "Code Coverage" タブで確認結果を表示できるようになるようにします。</p>
    <p>&nbsp;</p>
    <p>VSTest@2 に「<strong>codeCoverageEnabled: true</strong>」の１行を追加するだけです。</p>
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
  # .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: VSTest@2
  inputs:
    testAssemblyVer2: |
      **\$(BuildConfiguration)\testCounter1.dll
      **\$(BuildConfiguration)\testCounter2.dll
      **\$(BuildConfiguration)\testCounter3.dll
      !**\obj\**
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'
    <span class="auto-style2">codeCoverageEnabled: true</span>

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterWPF\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterForm\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container</pre>
    <p>&nbsp;</p>
    <p>Pipelines 実行後の「Code Coverage」画面です。</p>
    <p>評価対象である CounterDll.dll および関係するアセンブリのコードカバレッジ結果を確認することができるようになりました。</p>
    <p><a href="Pipelines_cs_netframework/img25.jpg" target="_blank">
    <img alt="Code Coverage" class="border" src="Pipelines_cs_netframework/img25.jpg" width="800"></a></p>
    <p>&nbsp;</p>
    <p>ですが不要なモジュール「nunit3.testadapter.dll 
    」のカバレッジ結果も含んでいます。関係はしているので含まれることは正常な動作と思いますが、これを削除したいと思いました。</p>
    <p>これを実現する方法を説明したページがありました。</p>
    <ul>
      <li>
      <a href="https://stackoverflow.com/questions/72616684/excluding-files-from-code-coverage-analysis-in-azure-devops-pipeline" target="_blank">
      unit testing - Excluding files from code coverage analysis in Azure devops 
      pipeline - Stack Overflow</a></li>
    </ul>
    <p>この内容に従って以下の修正を行います。</p>
    <p>".runsetting" というファイルを新規に作成し、CodeCoverage の対象から除外したいファイルを 
    &lt;Exclude&gt;～&lt;/Exclude&gt; の部分に記載します。ファイル名は別の名称でも問題ありません。</p>
    <p>&nbsp;</p>
    <p>[".runsetting"]</p>
    <pre class="prettyprint linenums lang-xml" style="width: 800px">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;RunSettings&gt;
  &lt;DataCollectionRunSettings&gt;
    &lt;DataCollectors&gt;
      &lt;DataCollector friendlyName="Code Coverage"&gt;
        &lt;Configuration&gt;
          &lt;CodeCoverage&gt;
            &lt;ModulePaths&gt;
              &lt;Exclude&gt;
                <span class="auto-style2">&lt;ModulePath&gt;nunit3.testadapter.dll&lt;/ModulePath&gt;</span>
                &lt;!-- Add more ModulePath nodes here. --&gt;
              &lt;/Exclude&gt;
            &lt;/ModulePaths&gt;
          &lt;/CodeCoverage&gt;
        &lt;/Configuration&gt;
      &lt;/DataCollector&gt;
    &lt;/DataCollectors&gt;
  &lt;/DataCollectionRunSettings&gt;
&lt;/RunSettings&gt;</pre>
    <p>&nbsp;</p>
    <p>そして、VSTest@2 に「<strong>runSettingsFile: '.\.runsettings'</strong>」の１行を追加するだけです。</p>
    <p>&nbsp;</p>
    <p>["azure-pipelines.yml"]</p>
    <pre class="prettyprint linenums lang-yml" style="width: 800px">
# .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: '$(solution)'

- task: VSBuild@1
  inputs:
    solution: '$(solution)'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

- task: VSTest@2
  inputs:
    testAssemblyVer2: |
      **\$(BuildConfiguration)\testCounter1.dll
      **\$(BuildConfiguration)\testCounter2.dll
      **\$(BuildConfiguration)\testCounter3.dll
      !**\obj\**
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'
    codeCoverageEnabled: true
    <span class="auto-style2">runSettingsFile: '.\.runsettings'</span>

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterWPF\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterWPF_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container

- task: ArchiveFiles@2
  displayName: "Archive files"
  inputs:
    rootFolderOrFile: CounterForm\bin\$(buildConfiguration)
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\CounterForm_$(Build.BuildId).zip'
    artifactName: 'MyBuildOutputs - zip'
    publishLocation: Container</pre>
    <p>&nbsp;</p>
    <p>以上の修正により、不要なモジュールの結果を除外することができました。</p>
    <p><a href="Pipelines_cs_netframework/img33.jpg" target="_blank">
    <img alt="Code Coverage" class="border" src="Pipelines_cs_netframework/img33.jpg" width="800"></a></p>
    <p>&nbsp;</p>
    <p>以上の手順により、一応カバレッジを計測して結果を見ることができました。しかし、出力結果は HTML や XML ではなく .coverage 
    拡張子なので、"Code Coverage" 
    画面上でソースコードと対比してのカバレッジ確認をすることはできませんでした。結果をダウンロードすることもできますが、カバレッジ計測に対応している 
    "Visual Studio Enterprise" 以外ではどちらにせよ内容を見られない、ということのようです。</p>
    <p>ここまで頑張ってみましたが、ソースコードと対比してカバレッジを確認できないのは残念でした。</p>
    <p>&nbsp;</p>
    <p>なんとか無料環境でコードカバレッジ結果を確認することを目指して、次章では OpenCover 
    を使ってカバレッジ計測を行う方法について取り組みしてみます。</p>
    <p>&nbsp;</p>
  </section>

  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a name="7._OpenCover_でカバレッジ計測">7. OpenCover でカバレッジ計測</a></h2>
    <p>無料環境でコードカバレッジ結果を確認することを目指して、本章では OpenCover を使ってカバレッジ計測を行う方法について取り組みしてみます。</p>
    <p>ローカルPCで OpenCover によるカバレッジ計測をできるようになってから、次に Azure の 
    Pipelines で OpenCover できるようにする、という順序で進めてみます。</p>
    <p>&nbsp;</p>
    
    <section>
      <h3><a name="7.1._ローカルPCで_OpenCover">7.1. ローカルPCで OpenCover</a></h3>
      <p>最初に NuGet を使って下記２つのパッケージを追加します。</p>
      <ul>
        <li>OpenCover</li>
        <li>ReportGenerator</li>
      </ul>
      <p>&nbsp;</p>
      <p>
      <img alt="NuGet" class="border" src="Pipelines_cs_netframework/img44.jpg" width="800"></p>
      <p>&nbsp;</p>
      <p>現在の環境を更新して以下に記載します。</p>
      <p>&nbsp;</p>
	
    	<p><strong>[環境]</strong></p>
      
    	<table>
    	<tbody>
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>コンパイラ :</td>
    	      <td>Visual Studio 2022,</td>
    	      <td>Version 17.8.4 </td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>開発言語:</td>
    	      <td>c#</td>
    	      <td>&nbsp;</td>
    	  </tr>
    	  
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    	  
    	  <tr>
    	    <td>フレームワーク：</td>
    	      <td>.NET Framework 4.8</td>
    	      <td>&nbsp;</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>テスト：</td>
    	      <td>MSTest.TestAdapter,</td>
    	      <td>3.1.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>MSTest.TestFramework,</td>
    	      <td>3.1.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    		
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>NUnit,</td>
    	      <td>4.0.1</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>&nbsp;</td>
    	      <td>NUnit3TestAdapter,</td>
    	      <td>4.5.0</td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td><strong></strong></td>
    	      <td><strong>OpenCover</strong></td>
    	      <td><strong>4.7.1221</strong></td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td><strong></strong></td>
    	      <td><strong>ReportGenerator</strong></td>
    	      <td><strong>5.2.0</strong></td>
    	  </tr>
    		
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    
    	  <tr>
    	    <td>OS :</td>
    	    <td>Windows11 home,</td>
    	    <td>23H2</td>
    	  </tr>
    	  
    	  <tr>
    	    <td class="td_separate" colspan="3"></td>
    	  </tr>
    	</tbody>
    	</table>
	
      <p>&nbsp;</p>
    
      <p>"<strong>OpenCover.Console.exe</strong>" から "<strong>vstest.console.exe</strong>" 
      を実行してテストを実行し、カバレッジ計測を行います。</p>
      <p>そして出力されたカバレッジ計測結果を "<strong>ReportGenerator.exe</strong>" を使って HTML 
      レポートを作成します。</p>
      <p>作成したバッチファイル例を記載します。</p>
      <p>&nbsp;</p>
      <p>["OpenCover.bat"]</p>
      <pre class="prettyprint linenums lang-bsh" style="width: 800px; white-space:pre-wrap">
rem Microsoft Visual Studio 2022 環境設定
call "C:\Program Files\Microsoft Visual Studio\2022\Community\Common7\Tools\VsDevCmd.bat"

rem OpenCoverの実行
.\packages\OpenCover.4.7.1221\tools\OpenCover.Console.exe -register:Path64 -target:"vstest.console.exe" -targetargs:"./testCounter*/bin/debug/testCounter*.dll" -targetdir:"." -filter:"+[CounterDll]*" -output:OpenCoverReport.xml

rem OpenCover の出力レポートを整形出力
.\packages\ReportGenerator.5.2.0\tools\net47\ReportGenerator.exe -reports:".\OpenCoverReport.xml" -reporttypes:html -targetdir:".\CoverageReport"

rem レポートを表示
.\CoverageReport\index.html

pause</pre>
      <p>&nbsp;</p>
      <p>上記バッチファイルを実行した様子の例です。</p>
      <p><a href="Pipelines_cs_netframework/img47.jpg" target="_blank">
      <img alt="OpenCover.bat 実行結果" class="border_with_drop-shadow" src="Pipelines_cs_netframework/img47.jpg" width="800"></a></p>
      <p>&nbsp;</p>
      <p>出力されたレポート例です。</p>
      <p><a href="Pipelines_cs_netframework/img49.jpg" target="_blank">
      <img alt="カバレッジ結果レポート" class="border" src="Pipelines_cs_netframework/img49.jpg" width="800"></a></p>
      <p>&nbsp;</p>
      <p><a href="Pipelines_cs_netframework/img4A1.jpg" target="_blank">
      <img alt="カバレッジ結果レポート" class="border" src="Pipelines_cs_netframework/img4A1.jpg" width="800"></a></p>
      <p>&nbsp;</p>
      <p>実際の出力例を 
      <a href="Pipelines_cs_netframework/CoverageReport/index.html" target="_blank">
      <strong>こちら</strong></a> から閲覧できるようにしてみました。よかったらどうぞ。</p>
      <p>&nbsp;</p>
    </section>
    
    <p>&nbsp;</p>
    
    <section>
      <h3><a name="7.2._Azure_DevOps_で_OpenCover">7.2. "Azure DevOps" で OpenCover</a></h3>
      <p>記載途中です。</p>
      <p>&nbsp;</p>
    </section>
    
    <p>&nbsp;</p>
  </section>

  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
    <h2><a id="ライセンス">ライセンス</a></h2>
    <p>本ページの情報は、特記無い限り下記 MIT ライセンスで提供されます。</p>
    <div class="license">
      The MIT License (MIT)<br><br>
      
      &nbsp; Copyright 2024 Kinoshita Hidetoshi<br><br>
      
      Permission is hereby granted, free of charge, to any person obtaining a copy
      of this software and associated documentation files (the "Software"), to deal
      in the Software without restriction, including without limitation the rights
      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
      copies of the Software, and to permit persons to whom the Software is
      furnished to do so, subject to the following conditions:<br><br>
      
      The above copyright notice and this permission notice shall be included in all
      copies or substantial portions of the Software.<br><br>
      
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
      SOFTWARE.
    </div>
    <p>&nbsp;</p>
  </section>
  
  <p>&nbsp;</p>
  
  <section>
  	<h2><a id="参考">参考</a></h2>
  	<ul>
  		<li>
        Azure DevOps Services | Microsoft Azure<br>
        <a href="https://azure.microsoft.com/ja-jp/products/devops/" target="_blank">
        https://azure.microsoft.com/ja-jp/products/devops/</a></li>
      <li>
        <a href="https://aonasuzutsuki.hatenablog.jp/entry/2020/12/03/140531" target="_blank">
        Azure Pipelines で.Net FrameworkとNUnitのテスト実行とカバレッジ計測してみる - 気まま研究所ブログ 
        (hatenablog.jp)</a></li>
      <li>
        <a href="https://iyemon018.hatenablog.com/entry/2019/03/17/155833" target="_blank">
        Azure Pipelines で.NET Framework + xUnit のユニットテストの実行と集計方法について - 
        やる気駆動型エンジニアの備忘録 (hatenablog.com)</a></li>
      <li>
        <a href="https://blog.nextscape.net/archives/Date/2019/06/devops-build-1" target="_blank">
        Azure DevOpsのBuild PipelineでWebAppsにデプロイ（Build編）|ネスケラボ (nextscape.net)</a></li>
      <li>
        <a href="https://tsuna-can.hateblo.jp/entry/2020/07/27/080000" target="_blank">
        Azure Pipelines のビルド結果画面にコードカバレッジの結果を表示する（.NET Core） - ツナ缶雑記 
        (hateblo.jp)</a></li>
      <li>
        <a href="https://learn.microsoft.com/ja-jp/azure/devops/pipelines/build/variables?view=azure-devops&amp;tabs=yaml" target="_blank">
        事前定義済み変数 - Azure Pipelines | Microsoft Learn</a></li>
      <li>
        <a href="https://stackoverflow.com/questions/72616684/excluding-files-from-code-coverage-analysis-in-azure-devops-pipeline" target="_blank">
        unit testing - Excluding files from code coverage analysis in Azure 
        devops pipeline - Stack Overflow</a></li>
  	</ul>
  </section>
  
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
  	<h2 style="margin-bottom:5px">変更履歴</h2>
  	<table>
  	  <tr>
  	    <td class="td_history_date">2024-01-18</td>
  	    <td class="td_history_separator">-</td>
  	    <td class="td_history">新規作成 </td>
  	  </tr>
  	</table>
  </section>
  
  <p>&nbsp;</p>
  
  <footer>
  	<p><small>&copy; 2024 Kinoshita Hidetoshi (木下英俊)</small></p>
  </footer>

</body>
</html>
