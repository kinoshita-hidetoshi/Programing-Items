<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="kinoshita hidetoshi (木下 英俊)">
  <meta name="description" content="木下英俊が自身のためにプログラムメモを残すことを目的に作成したページです。">
  <meta name="keywords" content="">
  <!-- キャッシュ無効化 -->
  <meta http-equiv="Cache-Control" content="no-cache">
	
  <!-- タイトル -->
  <title>[GitHub] SSHキーを使用してコミットに署名する | Programming Items</title>
	
  <!-- ファビコン -->
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <!-- CSS -->
  <link href="https://unpkg.com/ress/dist/ress.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../../design.css" type="text/css">
  
	<!-- Start for 'google-code-prettify' -->
	<link href="../../prettify/styles/desert.css" rel="stylesheet" type="text/css">
	<script src="../../prettify/prettify.js" type="text/javascript"></script>
	<!-- End for 'google-code-prettify' -->	
	
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V2DZQK54C2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-V2DZQK54C2');
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->

  <style type="text/css">
    .auto-style1 {
      background-color: #505000;
    }
  </style>

</head>

<body onload="prettyPrint();">
	
  <h1>[GitHub] SSHキーを使用してコミットに署名する</h1>
  
  <p>GitHub で SSHキーを使用してコミット署名する手順について記載します。</p>
  <p>&nbsp;</p>
  
  <div class="mokuji">
    <nav>
    	<h2>目次</h2>
    	<p><a href="#1._概要">1._概要</a></p>
      <p><a href="#2._既存の_SSH_キーを確認する">2._既存の_SSH_キーを確認する</a></p>
      <p><a href="#3._新しいSSHキーを生成して追加する">3._新しいSSHキーを生成して追加する</a></p>
      <p><a href="#4._GitHub_アカウントに_SSH_署名キーを追加する">4._GitHub_アカウントに_SSH_署名キーを追加する</a></p>
      <p><a href="#5._SSH_キーでコミットに署名する">5._SSH_キーでコミットに署名する</a></p>
      <p><a href="#6._git_commit_で常に署名するように設定する">6._git_commit_で常に署名するように設定する</a></p>
      <p><a href="#7._署名検証のステータス">7._署名検証のステータス</a></p>
      <p>&nbsp;</p>
    	<p><a href="#ライセンス">ライセンス</a></p>
    	<p><a href="#参考">参考</a></p>
    </nav>
  </div>
  
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  
  <section>
  	<h2> <a name="1._概要">1. 概要</a></h2>
    <p> &nbsp;</p>
    <h3>🔐 なぜ SSH 鍵で署名するの？</h3>
    <ul>
      <li><strong style="white-space: pre-wrap;">本人確認</strong>：誰がコミットしたかを明確にするため<br>
      コミットに署名すると、誰がコミットしたのかを受信者が検証できるようになります。特に、チームでの開発やオープンソースプロジェクトでこのプロセスは重要です。</li>
      <li><strong style="white-space: pre-wrap;">改ざん防止</strong>：コミットが第三者に改竄されていないことを保証<br>署名付きコミットを使用することで、コミットが正規の開発者によって作成されたことを証明できます。これにより、第三者がコードを不正に変更するリスクを軽減します。</li>
      <li><strong style="white-space: pre-wrap;">GPG より簡単</strong>：SSH 
      鍵はすでにリポジトリの認証に使っていることが多く、追加の設定が少ない</li>
    </ul>
    <p> &nbsp;</p>
  	<p>署名されたコミットは、下図のように <strong>GitHub</strong> の Commits 
    画面で <strong>Verified</strong> という表示で確認できます。</p>
    <p>&nbsp;</p>
    
    <figure>
      <img alt="GitHub コミット署名" src="signing_commits_with_ssh_key/img4.jpg" width="1000" class="border">
      <figcaption>署名されたコミットの表示例<span class="comment">（Verified）</span></figcaption>
    </figure>
    
    <p>&nbsp;</p>
    
    <div class="status_warning">
      <div></div>
      <div>
        <p><strong>注意</strong></p>
        <p>v2.34 以降の git で本機能を使用することができるようです。</p>
        <p>古い git を使用している場合は新しい git へ更新してお試しください。</p>
      </div>
    </div>

    <p>&nbsp;</p>
	
  </section>
  	
  <p>&nbsp;</p>
  
  <section>
  	<h2> <a name="2._既存の_SSH_キーを確認する">2. 既存の SSH キーを確認する</a></h2>
    <p> SSH キーがまだあるかどうかわからない場合は、ローカルで既存の SSH キーを確認できます。</p>
    <p> <strong>既存のSSHキーがあるかどうかを確認するには:</strong></p>
    <ol>
      <li>ターミナルで、次のコマンドを使用して、アクセスできるSSHキーを一覧表示します。<br><span class="cpp-source">
      ls -al ~/.ssh</span><br>もしくは .ssh フォルダ中に github 
      フォルダなどを作成して分けて扱っている場合は次のコマンドを使用します。<br><span class="cpp-source">ls -al 
      ~/.ssh/github</span></li>
      <li>出力をチェックして、SSH キー ペアがあるかどうかを確認します。 </li>
    </ol>
    <p>&nbsp;</p>
  </section>
	
  <p> &nbsp;</p>
  
  <section>
  	<h2> <a name="3._新しいSSHキーを生成して追加する">3. 新しい SSH キーを生成して追加する</a></h2>
    <p> まずはSSHキーを作成します。</p>
    <p> すでにSSH認証を使用している場合はこの手順をスキップできます。</p>
    
    <pre class="prettyprint lang-bsh" style="width:800px">ssh-keygen -t ed25519 -C "your_email@example.com"</pre>
    
    <p> &nbsp;</p>
    <p> 以下を表示したらそのまま Enter キーを押します。 </p>
    
    <pre class="prettyprint lang-bsh" style="width:800px">
Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):</pre>

    <p> &nbsp;</p>
    <p> パスフレーズはここではなしで進めます。以下が出てきたらそのまま Enter キーを押します。 </p>
    
    <pre class="prettyprint lang-bsh" style="width:800px">
Enter passphrase (empty for no passphrase):
Enter same passphrase again:</pre>

    <p> &nbsp;</p>
    <p> これでSSH鍵を作成できました。 <span class="cpp-source">Enter file in which to save 
    the key</span> で指定したディレクトリに秘密鍵と公開鍵の2つのファイルが作成されます。</p>
    <p> &nbsp;</p>
  </section>

  <p> &nbsp;</p>
  
  <section>
    <h2><a name="4._GitHub_アカウントに_SSH_署名キーを追加する">4. GitHub アカウントに SSH 署名キーを追加する</a></h2>
    <p>コミット署名検証用の公開鍵をGitHubに登録します。</p>
    <p>下図画面（<a href="https://github.com/settings/keys">SSH and GPG keys</a>）を開いて<strong>［New SSH key］</strong>ボタンをクリックします。</p>
    <p>&nbsp;</p>
    <p>
    <img alt="New SSH key" class="border" src="signing_commits_with_ssh_key/img1A.jpg" width="1000"></p>
    <p>&nbsp;</p>
    <p>
    事前に準備した公開鍵（例：id_ed25519.pub）を登録します。</p>
    <p>
    Title, Key type (<span class="cpp-source">Signing Key</span> を選択), Key 
    を登録したら<strong>［Add SSH key］</strong>ボタンをクリックします。</p>
    <p>
    <img alt="Add new SSH key" src="signing_commits_with_ssh_key/img22.jpg" width="1000" class="border"></p>
    <p>&nbsp;</p>
  </section>
  
  <p> &nbsp;</p>
  
  <section>
  	<h2> <a name="5._SSH_キーでコミットに署名する">5. SSH キーでコミットに署名する</a></h2>
    <p> SSH キーを使用してコミットに署名するには、ターミナル (CLI) を使用して次の手順に従います。</p>
    <p> 下記説明は、リポジトリ毎に設定する例を説明します。全ての git リポジトリを対象に設定する場合は "<span class="cpp-source">--global</span>" を付与して実施します。</p>
    <p> &nbsp;</p>
    <ol>
      <li>設定対象のフォルダ（git リポジトリ）へ移動します<br>
        <pre class="prettyprint" style="width: 800px">cd ****</pre></li>
      <li>キーの形式についてGitに伝えます。<br>
        <pre class="prettyprint lang-cpp" style="width: 800px">git config gpg.format ssh</pre>
      </li>
      <li>コミットの署名に使用するキーを Git に指示します。<br>
        <p>私の場合は <span class="cpp-source">~/.ssh/github/id_ed25519.pub</span> を公開鍵として使用しているので下記コマンドを使用します。<br></p>
        <pre class="prettyprint lang-cpp" style="width: 800px">git config user.signingkey ~/.ssh/github/id_ed25519.pub</pre>
      </li>
      <li>ローカルブランチに変更をコミットする場合は、コマンドのフラグ（-S）を使用します。<br>
        <pre class="prettyprint lang-cpp" style="width: 800px">git commit -S -m "your commit message"</pre>
        <p><span class="cpp-source">-S</span> を毎回つけるのが面倒な場合は、後述の "<a href="#5._git_commit_で常に署名するように設定する">5. git commit で常に署名するように設定する</a>" を確認してください。</p>
      </li>
      <li>SSH キーのパスフレーズを入力します。（パスフレーズを登録している場合のみ）<br> </li>
      <li>
      <p data-pm-slice="1 1 [&quot;orderedList&quot;,{&quot;order&quot;:1},&quot;listItem&quot;,null]" data-prosemirror-content-type="node" data-prosemirror-node-block="true" data-prosemirror-node-name="paragraph">
      [任意] ディレクトリにファイル 
      <span class="cpp-source" data-prosemirror-content-type="mark" data-prosemirror-mark-name="code" spellcheck="false">
      allowedSignersFile</span> をセットアップ<br>
      <span class="cpp-source">allowedSignersFile</span> は、Git で SSH 
      署名を使用したコミットやタグの検証を行う際に、信頼できる SSH 公開鍵をリストとして定義するファイルです。<br>
      ファイル名、ファイル保存場所 はなんでも良いのですが、ここでは対象リポジトリに config というフォルダを作成して 
      <span class="cpp-source">config/allowed_signers</span> 
      というファイルで登録してみます。このファイルへ対象リポジトリへコミットするユーザーの (1)メールアドレス、(2)公開鍵、を 
      <span class="cpp-source">allowedSignersFile</span> へ登録します。<br><br>登録手順例を以下に記載します。<span class="cpp-source">bitbucket@example.com</span> 
      および <span class="cpp-source">id_ed25519.pub</span> 
      を登録するユーザーのメールアドレス・公開鍵、へ置き換えて登録します。</p>
      
      <pre class="prettyprint" style="width: 800px">
echo "example@domain.com $(cat ~/.ssh/github/id_ed25519.pub)" &gt; config/allowed_signers
git config gpg.ssh.allowedSignersFile config/allowed_signers</pre>

      つまり、<span class="cpp-source">config/allowed_signers</span> に以下の形式で信頼する公開鍵を登録することを意味します。<br><br>
      
      <pre style="width:800px">「ユーザーのメールアドレス SSH公開鍵」</pre>
      
      <br>例えばこんな感じのファイルです。<br>
      ["config/allowed_signers"]<br>
      
      <pre class="prettyprint linenums lang-cpp" style="width: 800px">
example@domain.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAxxxxxx...
foo.boo@domain.com ssh-ed25519 ABCDE4NzaC1lZDI112345678xxxxxx...</pre>

      そして <span class="cpp-source">.git/config</span> には <span class="cpp-source">allowedSignersFile</span> のパスが記載されます。
       
      <br><br><strong>allowedSignersFile 登録しないとどうなる？</strong><br>ローカルでの署名検証に失敗します。署名付きのコミットを作成したり、GitHub 
      へプッシュしたりすることは問題なく行えます。 <br>ローカル環境で&nbsp;<span class="cpp-source">git log 
      --show-signature</span>&nbsp;などのコマンドを実行したときに署名が正しいかどうかを検証できず、エラーメッセージが表示されます。<br>
      <strong>エラー例</strong>:&nbsp;<span class="cpp-source">error: 
      gpg.ssh.allowedSignersFile needs to be configured and exist for ssh 
      signature verification</span><br>
      <br>

      </li>
      
      <li>[任意] 下記コマンドでコミットが署名されたことをローカルで確認します<br>
        <p>"<span class="cpp-source">-1</span>" は最新コミットから1つを表示します。</p>
        <p>"<span class="cpp-source">-3</span>" は最新コミットから3つを表示します。</p>
      
      <pre class="prettyprint lang-cpp" style="width: 800px">git log --show-signature -1</pre>
      表示例です。<br><img alt="実行結果例" src="../Bitbucket/siging_commits_with_ssh_key/img34.jpg"><br>

      </li>
      
      <li>以上を設定後の私の <span class="cpp-source">.git/config</span> ファイルを紹介します。<br>
      <p>項目の表示順序はいろいろなので気にしないでください。</p>
      <br>
      <p>["<span class="cpp-source">.git/config</span>"]</p>
      
      <pre class="prettyprint linenums lang-cpp" style="width: 800px">
[core]
        省略
[remote "origin"]
        省略
[branch "main"]
        省略
[user]
        signingkey = /home/hidetoshi/.ssh/github/id_ed25519.pub
[gpg "ssh"]
        allowedSignersFile = config/allowed_signers
[gpg]
        format = ssh
[commit]
        gpgsign = true</pre>
      <br>"<span class="cpp-source">--global</span>" を付けて設定した場合は、"<span class="cpp-source">~/.gitconfig</span>" 
      ファイルに同様の情報が記載されます。<br><br>["<span class="cpp-source">~/.gitconfig</span>"]<br>
      
      <pre class="prettyprint linenums lang-cpp" style="width: 800px">
[user]
        name = kinoshita hidetoshi
        email = ********@********.com
        signingkey = /home/hidetoshi/.ssh/github/id_ed25519.pub
[gpg "ssh"]
        allowedSignersFile = /home/hidetoshi/.ssh/allowed_signers
[gpg]
        format = ssh
[commit]
        gpgsign = true</pre>
      </li>
    </ol>
  </section>
	
  <p> &nbsp;</p>
  <p> &nbsp;</p>
  
  <section>
  	<h2> <a name="6._git_commit_で常に署名するように設定する">6. git commit で常に署名するように設定する</a></h2>
    <p>git commit 時に “-S“ を付けて実施することは面倒です。一部のツールではこれを補助する仕組みがある様子ですが、常に署名してくれる方が良い場合もありそうです。</p>
    <p>署名対象のディレクトリへ移動後、下記コマンドを実行します。</p>
    
    <pre class="prettyprint lang-cpp" style="width: 800px">git config commit.gpgsign true</pre>
    
    <p>&nbsp;</p>
    <p>もしくは全てを対象に有効化する場合は ‘--global’ を付けて下記コマンドを実行します。 </p>
    
    <pre class="prettyprint lang-cpp" style="width: 800px">git config --global commit.gpgsign true</pre>
    
    <p>&nbsp;</p>
    <p>後者のコマンドを実行後の私の .gitconfig ファイル例です。（メールアドレスは **** で変更表記しています）</p>
    <p><span class="cpp-source">gpfsign = true</span> の部分が追加されます。</p>
    
    <pre class="prettyprint linenums lang-cpp" style="width: 800px">
kinoshita@PC-FooBoo:~$ cat .gitconfig
[user]
        name = kinoshita hidetoshi
        email = ********@********.com
        signingkey = /home/kinoshita/.ssh/github/id_ed25519.pub
[gpg "ssh"]
        allowedSignersFile = /home/kinoshita/.ssh/allowed_signers
[gpg]
        format = ssh
[commit]
        g<span class="auto-style1">pgsign = true</span></pre>
        
    <p>&nbsp;</p>
    <p>以上の設定により git commit に “-S” を付けることなくコミットに対して常に署名するようになります。 </p>
  </section>
	
  <p> &nbsp;</p>
  <p> &nbsp;</p>
  
  <section>
  	<h2><a name="7._署名検証のステータス">7. 署名検証のステータス</a></h2>
    <p>以上の設定と署名付きコミットを行った後、GitHub へプッシュした Commits 画面を紹介します。</p>
    <p>下図の通り<span class="comment"><strong>［Verified］</strong></span>の表示が追加されました。</p>
    
    <figure>
      <img alt="GitHub コミット署名" src="signing_commits_with_ssh_key/img4.jpg" width="1000" class="border">
      <figcaption>署名されたコミットの表示例<span class="comment">（Verified）</span></figcaption>
    </figure>
    
    <p>&nbsp;</p>
        
    <table class="border-collapse" border="1" width="800">
      <caption>表 : ステータスと結果</caption>
      <thead class="standard_table">
        <tr>
          <th>ステータス</th>
          <th>結果</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Verified</strong></td>
          <td>コミットが署名され、署名が正常に検証されました</td>
        </tr>
        <tr>
          <td style="white-space: nowrap"><strong>Unverified</strong></td>
          <td>コミットは署名されていますが、署名を検証できませんでした</td>
        </tr>
        <tr>
          <td style="white-space:nowrap"><strong>No verification status</strong></td>
          <td>コミットが署名されていません</td>
        </tr>
      </tbody>
    </table>
    
    <p>&nbsp;</p>
        
  </section>
	
  <p> &nbsp;</p>
  
  <section>
    <h2><a id="ライセンス">ライセンス</a></h2>
    <p>本ページの情報は、特記無い限り下記 MIT ライセンスで提供されます。</p>
    <div class="license">
      The MIT License (MIT)<br><br>
      
      &nbsp; Copyright 2026 Kinoshita Hidetoshi<br><br>
      
      Permission is hereby granted, free of charge, to any person obtaining a copy
      of this software and associated documentation files (the "Software"), to deal
      in the Software without restriction, including without limitation the rights
      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
      copies of the Software, and to permit persons to whom the Software is
      furnished to do so, subject to the following conditions:<br><br>
      
      The above copyright notice and this permission notice shall be included in all
      copies or substantial portions of the Software.<br><br>
      
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
      SOFTWARE.
    </div>
    <p>&nbsp;</p>
  </section>
  
  <p> &nbsp;</p>
  
  <section>
  	<h2><a id="参考">参考</a></h2>
  	<ul>
  		<li><a href="https://docs.github.com/ja/authentication/managing-commit-signature-verification/signing-commits" target="_blank">
        コミットに署名する - GitHub ドキュメント</a></li>
      <li><a href="https://docs.github.com/ja/authentication/managing-commit-signature-verification/about-commit-signature-verification" target="_blank">
        コミット署名の検証について - GitHub ドキュメント</a></li>
      <li><a href="https://zenn.dev/beingish/articles/5beb088b807399" target="_blank">
        特定のリポジトリーで Git commit 時に署名するための設定</a></li>
      <li><a href="https://qiita.com/haw_ohnuma/items/51fa84449bc4a1393846" target="_blank">
        gitのcommitを署名付きにして偽装対策！ #Git - Qiita</a></li>
      <li><a href="https://qiita.com/tonnsama/items/c938b220b57e828cd288" target="_blank">
        GitのコミットにSSH鍵で署名してGitHub上でVerifiedマークをつけよう！ #Git - Qiita</a></li>
      <li>Visual Studio Code
      <ul>
        <li><a href="https://qiita.com/yumetodo/items/7c25c1d6de92921faa3e" target="_blank">
          WindowsにてVisual Studio Codeからcommitするときにgpg署名する #Git - Qiita</a></li>
        <li><a href="https://qiita.com/ItSANgo/items/37431ba32fbda43bdcc9" target="_blank">
          Visual Studio Code で Git Commit 時に GPG署名するには? #VSCode - Qiita</a></li>
        <li>
          <a href="https://zenn.dev/taniiicom/articles/git-commit-gpg-signature-vscode" target="_blank">
          vscode の Git パネルでも GPG 署名付きコミットを可能にする</a></li>
      </ul>
      </li>
  	</ul>
  </section>
  
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  
  <section>
  	<h2 style="margin-bottom:5px">変更履歴</h2>
  	<table>
  	  <tr>
  	    <td class="td_history_date">2026-02-13</td>
  	    <td class="td_history_separator">-</td>
  	    <td class="td_history">説明をリファクタ、ページデザイン調整、他</td>
  	  </tr>
  	  <tr>
  	    <td class="td_history_date">2026-01-20</td>
  	    <td class="td_history_separator">-</td>
  	    <td class="td_history">新規作成 </td>
  	  </tr>
  	</table>
  </section>
  
  <p>&nbsp;</p>
  
  <section>
  <p><a href="../../index.html" target="_parent">Programming Items トップページ</a></p>
  <p><a href="../../privacy_policy.html">プライバシーポリシー</a></p>
  </section>
  
  <p>&nbsp;</p>
  
  <footer>
  	<p><small>&copy; 2026 Kinoshita Hidetoshi (木下英俊)</small></p>
  </footer>
  
</body>
</html>
